

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1.3.1. How do I write a NeXus file? &mdash; NeXus: User Guide and Reference Documentation 2011-09 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2011-09',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="NeXus: User Guide and Reference Documentation 2011-09 documentation" href="../../../index.html" />
    <link rel="up" title="1.3. NAPI: The NeXus Application Programming Interface" href="../NAPI.html" />
    <link rel="next" title="1.3.2. How do I read a NeXus file?" href="read.html" />
    <link rel="prev" title="1.3. NAPI: The NeXus Application Programming Interface" href="../NAPI.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="read.html" title="1.3.2. How do I read a NeXus file?"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../NAPI.html" title="1.3. NAPI: The NeXus Application Programming Interface"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../index.html">NeXus: User Guide and Reference Documentation 2011-09 documentation</a> &raquo;</li>
          <li><a href="../../../contents.html" >Contents</a> &raquo;</li>
          <li><a href="../../index.html" >NeXus: User Manual</a> &raquo;</li>
          <li><a href="../index.html" >1. NeXus Introduction</a> &raquo;</li>
          <li><a href="../NAPI.html" accesskey="U">1.3. NAPI: The NeXus Application Programming Interface</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/nexuslogo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1.3.1. How do I write a NeXus file?</a><ul>
<li><a class="reference internal" href="#writing-a-simple-nexus-file">1.3.1.1. Writing a simple NeXus file</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../NAPI.html"
                        title="previous chapter">1.3. NAPI: The NeXus Application Programming Interface</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="read.html"
                        title="next chapter">1.3.2. How do I read a NeXus file?</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../_sources/volume1/introduction/howto/write.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="how-do-i-write-a-nexus-file">
<span id="introduction-howtowrite"></span><h1>1.3.1. How do I write a NeXus file?<a class="headerlink" href="#how-do-i-write-a-nexus-file" title="Permalink to this headline">¶</a></h1>
<span class="target" id="index-0"></span><p id="index-1">The NeXus Application Program Interface (API)
provides a set of subroutines that make it easy to read and write
NeXus files. These subroutines are available in C, Fortran 77, Fortran 90, Java,
Python, C++,
and IDL. Access from other languages, such as Python, is anticipated in the near
future. It is also possible to read NeXus HDF files in a number of data analysis
tools, such as LAMP, ISAW, IgorPro, and Open GENIE.  NeXus XML files can be read
by any program or library that supports XML.</p>
<p>The API uses a very simple <em>state</em>
model to navigate through a NeXus file.
When you open a file, the API provides a file <em>handle</em>,
which then stores the
current location, i.e. which group and/or field is currently open. Read and
write operations then act on the currently open entity.
Following the <a class="reference internal" href="../whatis/design.html#fig-simple-example"><em>Simple Data File Example</em></a>,
we walk through some parts of a typical NeXus program written in C.</p>
<div class="section" id="writing-a-simple-nexus-file">
<span id="ex-simple-write"></span><h2>1.3.1.1. Writing a simple NeXus file<a class="headerlink" href="#writing-a-simple-nexus-file" title="Permalink to this headline">¶</a></h2>
<div class="highlight-text" id="index-2"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre>#include &quot;napi.h&quot;

 int main()
 {
        NXhandle fileID;
        NXopen (&#39;NXfile.nxs&#39;, NXACC_CREATE, &amp;fileID);
          NXmakegroup (fileID, &quot;Scan&quot;, &quot;NXentry&quot;);
          NXopengroup (fileID, &quot;Scan&quot;, &quot;NXentry&quot;);
                NXmakegroup (fileID, &quot;data&quot;, &quot;NXdata&quot;);
                NXopengroup (fileID, &quot;data&quot;, &quot;NXdata&quot;);
                /* somehow, we already have arrays tth and counts, each length n*/
                  NXmakedata (fileID, &quot;two_theta&quot;, NX_FLOAT32, 1, &amp;n);
                  NXopendata (fileID, &quot;two_theta&quot;);
                        NXputdata (fileID, tth);
                        NXputattr (fileID, &quot;units&quot;, &quot;degrees&quot;, 7, NX_CHAR);
                  NXclosedata (fileID);  /* two_theta */, NX_INT32, 1, &amp;n);
                  NXopendata (fileID, &quot;counts&quot;);
                        NXputdata (fileID, counts);
                  NXclosedata (fileID);  /* counts */
                NXclosegroup (fileID);  /* data */
          NXclosegroup (fileID);  /* Scan */
        NXclose (&amp;fileID);
        return;
}
</pre></div>
</td></tr></table></div>
<dl class="docutils">
<dt>[line 6]</dt>
<dd>Open the file <tt class="docutils literal"><span class="pre">NXfile.nxs</span></tt> with
<em>create</em>
access (implying write access).
NAPI returns a file identifier of type <tt class="docutils literal"><span class="pre">NXhandle</span></tt>.</dd>
<dt>[line 7]</dt>
<dd>Next, we create an
<tt class="docutils literal"><span class="pre">NXentry</span></tt> group to contain the scan using
<tt class="docutils literal"><span class="pre">NXmakegroup()</span></tt> and then
open it for access using <tt class="docutils literal"><span class="pre">NXopengroup()</span></tt>.</dd>
<dt>[line 9]</dt>
<dd>The plottable data
is contained within an <tt class="docutils literal"><span class="pre">NXdata</span></tt> group, which must
also be created and opened.</dd>
</dl>
<dl class="docutils" id="index-3">
<dt>[line 12]</dt>
<dd>To create a field, call <tt class="docutils literal"><span class="pre">NXmakedata()</span></tt>, specifying the
data name, type (<tt class="docutils literal"><span class="pre">NX_FLOAT32</span></tt>), rank
(in this case,
<tt class="docutils literal"><span class="pre">1</span></tt>), and length of the array
(<tt class="docutils literal"><span class="pre">n</span></tt>). Then, it can be opened for writing.</dd>
</dl>
<dl class="docutils" id="index-4">
<dt>[line 14]</dt>
<dd>Write the data using <tt class="docutils literal"><span class="pre">NXputdata()</span></tt>.</dd>
<dt>[line 15]</dt>
<dd>With the field still open, we can also add some data attributes,
such as the data units,
which are specified as a character string (type <tt class="docutils literal"><span class="pre">NX_CHAR</span></tt>)
that is 7 bytes long.</dd>
</dl>
<span class="target" id="index-5"></span><dl class="docutils" id="index-6">
<dt>[line 16]</dt>
<dd>Then we close the field before opening another.
In fact, the API will do this automatically if you
attempt to open another field, but it is
better style to close it yourself.</dd>
<dt>[line 17]</dt>
<dd>The remaining fields in this group are added in a similar
fashion. Note that the indentation whenever a new field or
group are opened is just intended to make the structure of
the NeXus file more transparent.</dd>
<dt>[line 20]</dt>
<dd>Finally, close the groups (<tt class="docutils literal"><span class="pre">NXdata</span></tt> and
<tt class="docutils literal"><span class="pre">NXentry</span></tt>) before closing the file itself.</dd>
</dl>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="read.html" title="1.3.2. How do I read a NeXus file?"
             >next</a> |</li>
        <li class="right" >
          <a href="../NAPI.html" title="1.3. NAPI: The NeXus Application Programming Interface"
             >previous</a> |</li>
        <li><a href="../../../index.html">NeXus: User Guide and Reference Documentation 2011-09 documentation</a> &raquo;</li>
          <li><a href="../../../contents.html" >Contents</a> &raquo;</li>
          <li><a href="../../index.html" >NeXus: User Manual</a> &raquo;</li>
          <li><a href="../index.html" >1. NeXus Introduction</a> &raquo;</li>
          <li><a href="../NAPI.html" >1.3. NAPI: The NeXus Application Programming Interface</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, http://nexusformat.org.
      Last updated on Oct 13, 2011.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.
    </div>
  </body>
</html>