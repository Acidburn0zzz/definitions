

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2. NeXus Design &mdash; NeXus: User Guide and Reference Documentation v2011-08 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2011-08',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="NeXus: User Guide and Reference Documentation v2011-08 documentation" href="../index.html" />
    <link rel="up" title="1. NeXus: User Manual" href="index.html" />
    <link rel="next" title="2. NeXus: Reference Documentation" href="../volume2/index.html" />
    <link rel="prev" title="1. NeXus Introduction" href="introduction.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../volume2/index.html" title="2. NeXus: Reference Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="1. NeXus Introduction"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">NeXus: User Guide and Reference Documentation v2011-08 documentation</a> &raquo;</li>
          <li><a href="../contents.html" >Contents</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">1. NeXus: User Manual</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/nexuslogo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2. NeXus Design</a><ul>
<li><a class="reference internal" href="#nexus-objects-and-terms">2.1. NeXus Objects and Terms</a><ul>
<li><a class="reference internal" href="#data-groups">2.1.1. Data Groups</a></li>
<li><a class="reference internal" href="#data-fields">2.1.2. Data Fields</a></li>
<li><a class="reference internal" href="#data-attributes">2.1.3. Data Attributes</a><ul>
<li><a class="reference internal" href="#nexus-data-attributes">2.1.3.1. NeXus Data Attributes</a></li>
<li><a class="reference internal" href="#nexus-file-global-attributes">2.1.3.2. NeXus File Global Attributes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-links">2.1.4. Data Links</a><ul>
<li><a class="reference internal" href="#linking-in-a-nexus-file">2.1.4.1. Linking in a NeXus file.</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nexus-base-classes">2.1.5. NeXus Base Classes</a></li>
<li><a class="reference internal" href="#nxdata-facilitates-automatic-plotting">2.1.6. <cite>NXdata</cite> Facilitates Automatic Plotting</a></li>
<li><a class="reference internal" href="#nexus-application-definitions">2.1.7. NeXus Application Definitions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="introduction.html"
                        title="previous chapter">1. NeXus Introduction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../volume2/index.html"
                        title="next chapter">2. NeXus: Reference Documentation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/volume1/design.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="nexus-design">
<span id="id1"></span><h1>2. NeXus Design<a class="headerlink" href="#nexus-design" title="Permalink to this headline">¶</a></h1>
<p>This chapter actually defines the rules to use for
writing valid NeXus files. An explanation of NeXus objects
is followed by the definition of NeXus coordinate systems,
the rules for structuring files and the rules for
storing single items of data.</p>
<span class="target" id="index-0"></span><div class="sidebar" id="index-1">
<p class="first sidebar-title">Note</p>
<p class="last">In this manual, we use the terms <em>field</em>, <em>data field</em>, and
<em>data item</em> synonymously to be consistent
with their meaning between NeXus data file instances and
NXDL specification files.</p>
</div>
<p>The structure of NeXus files is extremely flexible,
allowing the storage both of simple data sets, such as a
single data array and its axes, and also of highly complex
data, such as the simulation results or an entire
multi-component instrument. This flexibility is a necessity
as NeXus strives to capture data from a wild variety of
applications in x-ray, muSR and neutron scattering. The
flexibility is achieved through a hierarchical
structure, with related <em>fields</em>
collected together into <em>groups</em>,
making NeXus files easy to navigate, even without any
documentation. NeXus files are self-describing, and
should be easy to understand, at
least by those familiar with the experimental technique.</p>
<div class="section" id="nexus-objects-and-terms">
<span id="design-objects"></span><h2>2.1. NeXus Objects and Terms<a class="headerlink" href="#nexus-objects-and-terms" title="Permalink to this headline">¶</a></h2>
<p>Before discussing the design of NeXus in greater detail
it is necessary to define the objects and terms
used by NeXus. These are:</p>
<dl class="docutils">
<dt><em>Groups</em></dt>
<dd>Group data fields and other groups together.
Groups represent levels in the NeXus hierarchy</dd>
<dt><em>Data fields</em></dt>
<dd>Multidimensional arrays and scalars
representing the actual data to be stored</dd>
<dt><em>Attributes</em></dt>
<dd>Additional metadata which can be assigned
to groups or data fields</dd>
<dt><em>Links</em></dt>
<dd>Elements which point to data stored in
another place in the file hierarchy</dd>
<dt><em>NeXus Classes</em></dt>
<dd>Dictionaries of names possible in the
various types of NeXus groups</dd>
<dt><em>Application Definitions</em></dt>
<dd>Describe the content of a NeXus file
for a particular usage case</dd>
</dl>
<p>In the following sections these elements of
NeXus files will be defined in more detail.</p>
<div class="section" id="data-groups">
<span id="design-groups"></span><h3>2.1.1. Data Groups<a class="headerlink" href="#data-groups" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-2"></span><span class="target" id="index-3"></span><p id="index-4">NeXus files consist of data groups,
which contain fields and/or other
groups to form a hierarchical structure.
This hierarchy is designed to make it
easy to navigate a NeXus file by storing related fields together. Data
groups are identified both by a name, which must be unique within a particular
group, and a class. There can be multiple groups with the same class
but they must have different names (based on the HDF rules).
For the class names used with NeXus data groups
the prefix <cite>NX</cite> is reserved. Thus all NeXus class
names start with <cite>NX</cite>.</p>
</div>
<div class="section" id="data-fields">
<span id="design-fields"></span><h3>2.1.2. Data Fields<a class="headerlink" href="#data-fields" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-5"></span><p id="index-6">Data fields
contain the essential information stored in a NeXus file. They can
be scalar values or multidimensional arrays of a variety of sizes (1-byte,
2-byte, 4-byte, 8-byte) and types (integers, floats, characters). The fields may
store both experimental results (counts, detector angles, etc), and other
information associated with the experiment (start and end times, user names,
etc). Data fields are identified by their names, which must be unique within the
group in which they are stored.</p>
</div>
<div class="section" id="data-attributes">
<span id="design-attributes"></span><h3>2.1.3. Data Attributes<a class="headerlink" href="#data-attributes" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-7"></span><span class="target" id="index-8"></span><span class="target" id="index-9"></span><p id="index-10">Attributes
are extra (meta-)information that are associated with particular
fields. They are used to annotate the data, for example with physical units
or calibration offsets, and may be scalar numbers or character
strings. NeXus also uses attributes to identify plottable data
and their axes, etc.
A description of possible attributes can be found
in the table titled <a class="reference internal" href="#table-exampleattributes"><em>NeXus Data Attributes</em></a>.
Finally, NeXus files themselves have global
attributes which are listed in the <a class="reference internal" href="#table-globalattributes"><em>NeXus File Global Attributes</em></a> table
that identify the NeXus version, file creation time, etc.
Attributes are identified by their
names, which must be unique in each field.</p>
<div class="section" id="nexus-data-attributes">
<span id="table-exampleattributes"></span><h4>2.1.3.1. NeXus Data Attributes<a class="headerlink" href="#nexus-data-attributes" title="Permalink to this headline">¶</a></h4>
<p>For the full specification of attributes,
see <a class="reference internal" href="../cheatsheet.html#volume2-nxdl-section"><em>volume2.NXDL.section (not converted yet)</em></a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="14%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Name</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>units</td>
<td>NX_CHAR</td>
<td>Data units, given as character strings,
must conform to the NeXus units standard.
See the &#8220;NeXus units&#8221; section
for details.</td>
</tr>
<tr><td>signal</td>
<td>NX_INT</td>
<td>Defines which data set contains the
signal to be plotted use <cite>signal=&#8221;1&#8221;</cite>
for main signal</td>
</tr>
<tr><td>axes</td>
<td>NX_CHAR</td>
<td>Defines the names of the dimension
scales for this data set as a
colon-delimited list. For example,
suppose data is an array with elements
<cite>data[j][i]</cite> (C)
or <cite>data(i,j)</cite> (Fortran), with
dimension scales <cite>time_of_flight[i]</cite>
and <cite>polar_angle[j]</cite>, then data would
have an attribute
<cite>axes=&#8221;polar_angle:time_of_flight&#8221;</cite>
in addition to an attribute
<cite>signal=&#8221;1&#8221;</cite>.</td>
</tr>
<tr><td>axis</td>
<td>NX_INT</td>
<td>The original way of designating data
for plotting, now superceded by the
axes attribute. This defines the rank
of the signal data for which this data
set is a dimension scale in order of
the fastest varying index (see a longer
discussion in the section on NXdata
<a class="reference internal" href="../cheatsheet.html#nxdata-structure"><em>nxdata-structure (not converted yet)</em></a>
structure),
i.e. if the array being stored is data,
with elements <cite>data[j][i]</cite> in C and
<cite>data(i,j)</cite> in Fortran, axis would
have the following values:
ith dimension (<cite>axis=&#8221;1&#8221;</cite>),
jth dimension (<cite>axis=&#8221;2&#8221;</cite>), etc.</td>
</tr>
<tr><td>primary</td>
<td>NX_INT32</td>
<td>Defines the order of preference for
dimension scales which apply to the
same rank of signal data. Use
<cite>primary=&#8221;1&#8221;</cite> to indicate preferred
dimension scale</td>
</tr>
<tr><td>long_name</td>
<td>NX_CHAR</td>
<td>Defines title of signal data or
axis label of dimension scale</td>
</tr>
<tr><td>calibration_status</td>
<td>NX_CHAR</td>
<td>Defines status of data value.
Set to &#8220;Nominal&#8221; or &#8220;Measured&#8221;</td>
</tr>
<tr><td>offset</td>
<td>NX_INT</td>
<td>Rank values off offsets to use for
each dimension if the data is not in
C storage order</td>
</tr>
<tr><td>stride</td>
<td>NX_INT</td>
<td>Rank values of steps to use when
incrementing the dimension</td>
</tr>
<tr><td>transformation_type</td>
<td>NX_CHAR</td>
<td>translation or totation</td>
</tr>
<tr><td>vector</td>
<td>NX_FLOAT</td>
<td>3 values describing the axis of
rotation or the direction of translation</td>
</tr>
<tr><td>interpretation</td>
<td>NX_CHAR</td>
<td>Describes how to display the data.
Allowed values include:
scaler (0-D data),
spectrum (1-D data),
image (2-D data),
or vertex (3-D data).</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="nexus-file-global-attributes">
<span id="table-globalattributes"></span><h4>2.1.3.2. NeXus File Global Attributes<a class="headerlink" href="#nexus-file-global-attributes" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="15%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Name</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>file_name</td>
<td>NX_CHAR</td>
<td>File name of original NeXus file to
assist in identification if the external
name has been changed</td>
</tr>
<tr><td>file_time</td>
<td>ISO 8601</td>
<td>Date and time of file creation</td>
</tr>
<tr><td>file_update_time</td>
<td>ISO 8601</td>
<td>Date and time of last file change
at close</td>
</tr>
<tr><td>NeXus_version</td>
<td>NX_CHAR</td>
<td>Version of NeXus API used in writing
the file</td>
</tr>
<tr><td>creator</td>
<td>NX_CHAR</td>
<td>Facility or program where the file
originated</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="data-links">
<span id="design-links"></span><h3>2.1.4. Data Links<a class="headerlink" href="#data-links" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-11"></span><p id="index-12">Links are pointers to existing data somewhere else.
The concept is very much like
symbolic links in a unix filesystem.
The NeXus definition sometimes requires
access to the same data in different groups
within the same file.
For example: detector data is stored in the
<tt class="docutils literal"><span class="pre">NXinstrument/NXdetector</span></tt> group
but may be needed in <tt class="docutils literal"><span class="pre">NXdata</span></tt> for automatic plotting.
Rather then replicating the data, NeXus uses
links in such situations. See the figure <a class="reference internal" href="#fig-data-linking"><em>Linking in a NeXus file.</em></a> for
a more descriptive representation of the concept of linking.</p>
<div class="section" id="linking-in-a-nexus-file">
<span id="fig-data-linking"></span><h4>2.1.4.1. Linking in a NeXus file.<a class="headerlink" href="#linking-in-a-nexus-file" title="Permalink to this headline">¶</a></h4>
<div class="figure">
<img alt="../_images/data-linking.png" src="../_images/data-linking.png" style="width: 400pt;" />
<p class="caption">Linking in a NeXus file.
See example code below: <a class="reference internal" href="../cheatsheet.html#example-data-linking"><em>example.data-linking (not converted yet)</em></a></p>
</div>
</div>
</div>
<div class="section" id="nexus-base-classes">
<span id="design-nexusclasses"></span><h3>2.1.5. NeXus Base Classes<a class="headerlink" href="#nexus-base-classes" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-13"></span><p id="index-14">Data groups often describe objects in the experiment (monitors, detectors,
monochromators, etc.), so that the contents (both data fields and/or other data
groups) comprise the properties of that object. NeXus has defined a set of standard
objects, or base classes, out of which a NeXus file can be constructed. This is each data group
is identified by a name and a class. The group class, defines the type of object
and the properties that it can contain, whereas the group name defines a unique instance
of that class. These classes are
defined in XML using the NeXus Definition Language (NXDL)
format. All NeXus class types adopted by the NIAC <em>must</em>
begin with <cite>NX</cite>.
Classes not adopted by the NIAC <em>must not</em>
start with <cite>NX</cite>.</p>
<p id="index-15">Not all classes define physical objects. Some refer to logical groupings of
experimental information, such as plottable data,
sample environment logs, beam
profiles, etc.
There can be multiple instances of each class. On
the other hand, a typical NeXus file will only contain a small subset of the
possible classes.</p>
<p>NeXus base classes are not proper classes in the
same sense as used in object oriented programming
languages. In fact the use of the term classes is
actually misleading but has established itself
during the development of NeXus. NeXus base
classes are rather dictionaries of field names
and their meanings which are permitted in a
particular NeXus group implementing the NeXus
class. This sounds complicated but becomes easy
if you consider that most NeXus groups describe
instrument components. Then for example, a
<cite>NXmonochromator</cite> base class describes all the
possible field names which NeXus allows to be
used to describe a monochromator.</p>
<p>Most NeXus base classes represent instrument components.
Some are used as containers to structure information in a
file (<cite>NXentry</cite>, <cite>NXcollection</cite>, <cite>NXinstrument</cite>,
<cite>NXprocess</cite>, <cite>NXparameter</cite>). But there are some base
classes which have special uses which need to be
mentioned here:</p>
<dl class="docutils">
<dt><cite>NXdata</cite></dt>
<dd><cite>NXdata</cite> is used to identify the default plottable data.
The notion of a default plot of data is a basic
motivation of NeXus.</dd>
<dt><cite>NXlog</cite></dt>
<dd><cite>NXlog</cite> is used to store time stamped data like the
log of a temperature controller. Basically you give
a start time, and arrays with a difference in seconds
to the start time and the values read.</dd>
<dt><cite>NXnote</cite></dt>
<dd><cite>NXnote</cite> provides a place to store general notes,
images, video or whatever. A mime type is stored
together with a binary blob of data. Please use this
only for auxiliary information, for example an image
of your sample, or a photo of your boss.</dd>
<dt><cite>NXgeometry</cite></dt>
<dd><cite>NXgeometry</cite> and its subgroups <cite>NXtranslation</cite>,
<cite>NXorientation</cite>, <cite>NXshape</cite> are used to store absolute
positions in the laboratory coordinate system or to
define shapes.</dd>
</dl>
<p>These groups can appear anywhere in the NeXus hierarchy,
where needed. Preferably close to the component they
annotate or in a <cite>NXcollection</cite>. All of the base classes
are documented in the reference manual.</p>
</div>
<div class="section" id="nxdata-facilitates-automatic-plotting">
<span id="nxdata-facilitates-thedefaultplot"></span><h3>2.1.6. <cite>NXdata</cite> Facilitates Automatic Plotting<a class="headerlink" href="#nxdata-facilitates-automatic-plotting" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-16"></span><span class="target" id="index-17"></span><p id="index-18">The most notable special base class
(also known as <em>group</em>) in NeXus is <cite>NXdata</cite>.
<cite>NXdata</cite> is the answer to a basic motivation of NeXus
to facilitate automatic plotting of data.
<cite>NXdata</cite> is designed to contain the main dataset
and its associated dimension scales (axes) of a
NeXus data file. The usage scenario is that an
automatic data plotting program just opens a
<cite>NXentry</cite> and then continues to search for any
<cite>NXdata</cite> groups. These <cite>NXdata</cite> groups represent
the plottable data.  Here is the way an
automatic plotting program ought to work:</p>
<ol class="arabic simple">
<li>Search for NXentry groups</li>
<li>Open an NXentry</li>
<li>Search for NXdata groups</li>
<li>Open an NXdata group</li>
<li>Identify the plottable data.</li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li>Search for a dataset with attribute <cite>signal=1</cite>.
This is your main dataset.
(There should be only one dataset that matches.)</li>
<li>Try to read the axes attribute of the
main dataset, if it exists.</li>
</ol>
<blockquote>
<div><ol class="lowerroman simple">
<li>The value of axes is a colon- or
comma-separated list of the datasets describing
the dimension scales
(such as <cite>axes=&#8221;polar_angle:time_of_flight&#8221;</cite>).</li>
<li>Parse axes and open the datasets to describe
your dimension scales</li>
</ol>
</div></blockquote>
<ol class="arabic simple">
<li>If axes does not exist:</li>
</ol>
<blockquote>
<div><ol class="lowerroman simple">
<li>Search for datasets with attributes
<cite>axis=1</cite>, <cite>axis=2</cite>, etc.
These are the datasets describing your axis.
There may be several datasets for any axis,
i.e. there may be multiple datasets with
the attribute <cite>axis=1</cite>. Among them the
dataset with the attribute <cite>primary=1</cite> is
the preferred one. All others are
alternative dimension scales.</li>
<li>Open the datasets to describe
your dimension scales.</li>
</ol>
</div></blockquote>
</div></blockquote>
<ol class="arabic simple">
<li>Having found the default plottable data
and its dimension scales: make the plot</li>
</ol>
</div>
<div class="section" id="nexus-application-definitions">
<span id="design-nexusapplications"></span><h3>2.1.7. NeXus Application Definitions<a class="headerlink" href="#nexus-application-definitions" title="Permalink to this headline">¶</a></h3>
<p>The objects described so far provide us with the means to
store data from a wide variety of instruments, simulations
or processed data as resulting from data analysis.
But NeXus strives to express strict standards for certain
applications of NeXus too. The tool which NeXus uses for
the expression of such strict standards is the NeXus
Application Definition. A NeXus Application Definition
describes which groups and data items have to be present
in a file in order to properly describe an application
of NeXus. For example for describing a powder diffraction
experiment. Typically an application definition will contain
only a small subset of the many groups and fields defined
in NeXus. NeXus application definitions are also expressed
in the NeXus Definition Language (NXDL). A tool exists which
allows to validate a NeXus file against a given
application definition.</p>
<p>Another way to look at a NeXus application definition
is as a contract between a file writer and a file consumer
(reader). A contract which reads:
<em>If you write your files
following a particular NeXus application definition,
I can process these files with my software</em>.</p>
<p>Yet another way to look at a NeXus application definition
is to understand it as an interface definition between data
files and the software which uses this file. Much like an
interface in the Java or other modern object oriented
programming languages.</p>
<p>In contrast to NeXus base classes, NeXus supports inheritance
in application definitions.</p>
<p>Please note that a NeXus Application Definition will only
define the bare minimum of data necessary to perform common
analysis with data. Practical files will nearly always
contain more data. One of the beauties of NeXus is that it
is always possible to add more data to a file without breaking
its compliance with its application definition.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../volume2/index.html" title="2. NeXus: Reference Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="1. NeXus Introduction"
             >previous</a> |</li>
        <li><a href="../index.html">NeXus: User Guide and Reference Documentation v2011-08 documentation</a> &raquo;</li>
          <li><a href="../contents.html" >Contents</a> &raquo;</li>
          <li><a href="index.html" >1. NeXus: User Manual</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, http://nexusformat.org.
      Last updated on Sep 11, 2011.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>