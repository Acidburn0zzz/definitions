

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2. NeXus Design &mdash; NeXus: User Guide and Reference Documentation v2011-08 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2011-08',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="NeXus: User Guide and Reference Documentation v2011-08 documentation" href="../index.html" />
    <link rel="up" title="NeXus: User Manual" href="index.html" />
    <link rel="next" title="NeXus: Reference Documentation" href="../volume2/index.html" />
    <link rel="prev" title="1. NeXus Introduction" href="introduction.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../volume2/index.html" title="NeXus: Reference Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="1. NeXus Introduction"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">NeXus: User Guide and Reference Documentation v2011-08 documentation</a> &raquo;</li>
          <li><a href="../contents.html" >Contents</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">NeXus: User Manual</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/nexuslogo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2. NeXus Design</a><ul>
<li><a class="reference internal" href="#nexus-objects-and-terms">2.1. NeXus Objects and Terms</a><ul>
<li><a class="reference internal" href="#data-groups">2.1.1. Data Groups</a></li>
<li><a class="reference internal" href="#data-fields">2.1.2. Data Fields</a></li>
<li><a class="reference internal" href="#data-attributes">2.1.3. Data Attributes</a><ul>
<li><a class="reference internal" href="#example-nexus-data-attributes">2.1.3.1. Example NeXus Data Attributes</a></li>
<li><a class="reference internal" href="#nexus-file-global-attributes">2.1.3.2. NeXus File Global Attributes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-links">2.1.4. Data Links</a><ul>
<li><a class="reference internal" href="#linking-in-a-nexus-file">2.1.4.1. Linking in a NeXus file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nexus-classes">2.1.5. NeXus Classes</a><ul>
<li><a class="reference internal" href="#nxdata-facilitates-automatic-plotting">2.1.5.1. <cite>NXdata</cite> Facilitates Automatic Plotting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nexus-application-definitions">2.1.6. NeXus Application Definitions</a></li>
<li><a class="reference internal" href="#nexus-coordinate-systems">2.1.7. NeXus Coordinate Systems</a><ul>
<li><a class="reference internal" href="#mcstas-and-nxgeometry-system">2.1.7.1. McStas and <cite>NXgeometry</cite> System</a></li>
<li><a class="reference internal" href="#simple-spherical-polar-coordinate-system">2.1.7.2. Simple (Spherical Polar) Coordinate System</a></li>
<li><a class="reference internal" href="#coordinate-transformations">2.1.7.3. Coordinate Transformations</a><ul>
<li><a class="reference internal" href="#actions-of-standard-nexus-fields">2.1.7.3.1. Actions of standard NeXus fields</a><ul>
<li><a class="reference internal" href="#rules-for-storing-data-items-in-nexus-files">2.1.7.3.1.1. Rules for Storing Data Items in NeXus Files</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#naming-conventions">2.1.7.4. Naming Conventions</a></li>
<li><a class="reference internal" href="#nexus-storage">2.1.7.5. NeXus Storage</a><ul>
<li><a class="reference internal" href="#non-c-storage-order">2.1.7.5.1. Non C Storage Order</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#offset-and-stride-for-1-d-data">2.1.8. Offset and Stride for 1-D data</a></li>
<li><a class="reference internal" href="#offset-and-stride-for-2-d-data">2.1.9. Offset and Stride for 2-D data</a></li>
<li><a class="reference internal" href="#offset-and-stride-for-3-d-data">2.1.10. Offset and Stride for 3-D data</a></li>
<li><a class="reference internal" href="#data-value-transformations">2.1.11. Data Value Transformations</a><ul>
<li><a class="reference internal" href="#nexus-data-types">2.1.11.1. NeXus Data Types</a></li>
<li><a class="reference internal" href="#nexus-dates-and-times">2.1.11.2. NeXus dates and times</a></li>
<li><a class="reference internal" href="#nexus-units">2.1.11.3. NeXus Units</a></li>
<li><a class="reference internal" href="#linking-multi-dimensional-data-with-axis-data">2.1.11.4. Linking Multi Dimensional Data with Axis Data</a><ul>
<li><a class="reference internal" href="#linking-by-name-using-the-axes-attribute">2.1.11.4.1. Linking by name using the <cite>axes</cite> attribute</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#preferred-way-of-denoting-axes">2.1.12. Preferred way of denoting axes</a></li>
<li><a class="reference internal" href="#linking-by-dimension-number-using-the-axis-attribute">2.1.13. Linking by dimension number using the <cite>axis</cite> attribute</a></li>
<li><a class="reference internal" href="#discussion-of-the-two-linking-methods">2.1.14. Discussion of the two linking methods</a><ul>
<li><a class="reference internal" href="#storing-detectors">2.1.14.1. Storing Detectors</a></li>
<li><a class="reference internal" href="#monitors-are-special">2.1.14.2. Monitors are Special</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="introduction.html"
                        title="previous chapter">1. NeXus Introduction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../volume2/index.html"
                        title="next chapter">NeXus: Reference Documentation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/volume1/design.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="nexus-design">
<span id="id1"></span><h1>2. NeXus Design<a class="headerlink" href="#nexus-design" title="Permalink to this headline">¶</a></h1>
<p>This chapter actually defines the rules to use for
writing valid NeXus files. An explanation of NeXus objects
is followed by the definition of NeXus coordinate systems,
the rules for structuring files and the rules for
storing single items of data.</p>
<span class="target" id="index-0"></span><div class="sidebar" id="index-1">
<p class="first sidebar-title">Note</p>
<p class="last">In this manual, we use the terms <em>field</em>, <em>data field</em>, and
<em>data item</em> synonymously to be consistent
with their meaning between NeXus data file instances and
NXDL specification files.</p>
</div>
<p>The structure of NeXus files is extremely flexible,
allowing the storage both of simple data sets, such as a
single data array and its axes, and also of highly complex
data, such as the simulation results or an entire
multi-component instrument. This flexibility is a necessity
as NeXus strives to capture data from a wild variety of
applications in x-ray, muSR and neutron scattering. The
flexibility is achieved through a hierarchical
structure, with related <em>fields</em>
collected together into <em>groups</em>,
making NeXus files easy to navigate, even without any
documentation. NeXus files are self-describing, and
should be easy to understand, at
least by those familiar with the experimental technique.</p>
<div class="section" id="nexus-objects-and-terms">
<span id="design-objects"></span><h2>2.1. NeXus Objects and Terms<a class="headerlink" href="#nexus-objects-and-terms" title="Permalink to this headline">¶</a></h2>
<p>Before discussing the design of NeXus in greater detail
it is necessary to define the objects and terms
used by NeXus. These are:</p>
<dl class="docutils">
<dt><a class="reference internal" href="#design-groups"><em>Data Groups</em></a></dt>
<dd>Group data fields and other groups together.
Groups represent levels in the NeXus hierarchy</dd>
<dt><a class="reference internal" href="#design-fields"><em>Data Fields</em></a></dt>
<dd>Multidimensional arrays and scalars
representing the actual data to be stored</dd>
<dt><a class="reference internal" href="#design-attributes"><em>Data Attributes</em></a></dt>
<dd>Additional metadata which can be assigned
to groups or data fields</dd>
<dt><a class="reference internal" href="#design-links"><em>Data Links</em></a></dt>
<dd>Elements which point to data stored in
another place in the file hierarchy</dd>
<dt><a class="reference internal" href="#design-nexusclasses"><em>NeXus Classes</em></a></dt>
<dd>Dictionaries of names possible in the
various types of NeXus groups</dd>
<dt><a class="reference internal" href="#design-nexusapplications"><em>NeXus Application Definitions</em></a></dt>
<dd>Describe the content of a NeXus file
for a particular usage case</dd>
<dt><a class="reference internal" href="#design-coordinatesystem"><em>NeXus Coordinate Systems</em></a></dt>
<dd>Coordinate systems are used to describe the
positions and orientations of objects.</dd>
<dt>Rules</dt>
<dd>Rules for Structuring Information in NeXus Files</dd>
<dt>Data Rules</dt>
<dd>This section describes the rules which apply
for storing single data fields in data files.</dd>
<dt>File Formats</dt>
<dd>This section describes how NeXus structures
are mapped to features of the underlying
physical file format.</dd>
</dl>
<p>In the following sections these elements of
NeXus files will be defined in more detail.</p>
<div class="section" id="data-groups">
<span id="design-groups"></span><h3>2.1.1. Data Groups<a class="headerlink" href="#data-groups" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-2"></span><span class="target" id="index-3"></span><p id="index-4">NeXus files consist of data groups,
which contain fields and/or other
groups to form a hierarchical structure.
This hierarchy is designed to make it
easy to navigate a NeXus file by storing related fields together. Data
groups are identified both by a name, which must be unique within a particular
group, and a class. There can be multiple groups with the same class
but they must have different names (based on the HDF rules).
For the class names used with NeXus data groups
the prefix <cite>NX</cite> is reserved. Thus all NeXus class
names start with <cite>NX</cite>.</p>
</div>
<div class="section" id="data-fields">
<span id="design-fields"></span><h3>2.1.2. Data Fields<a class="headerlink" href="#data-fields" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-5"></span><p id="index-6">Data fields
contain the essential information stored in a NeXus file. They can
be scalar values or multidimensional arrays of a variety of sizes (1-byte,
2-byte, 4-byte, 8-byte) and types (integers, floats, characters). The fields may
store both experimental results (counts, detector angles, etc), and other
information associated with the experiment (start and end times, user names,
etc). Data fields are identified by their names, which must be unique within the
group in which they are stored.</p>
</div>
<div class="section" id="data-attributes">
<span id="design-attributes"></span><h3>2.1.3. Data Attributes<a class="headerlink" href="#data-attributes" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-7"></span><span class="target" id="index-8"></span><span class="target" id="index-9"></span><p id="index-10">Attributes
are extra (meta-)information that are associated with particular
fields. They are used to annotate the data, for example with physical units
or calibration offsets, and may be scalar numbers or character
strings. NeXus also uses attributes to identify plottable data
and their axes, etc.
A description of possible attributes can be found
in the table titled <a class="reference internal" href="#table-exampleattributes"><em>Example NeXus Data Attributes</em></a>.
Finally, NeXus files themselves have global
attributes which are listed in the <a class="reference internal" href="#table-globalattributes"><em>NeXus File Global Attributes</em></a> table
that identify the NeXus version, file creation time, etc.
Attributes are identified by their
names, which must be unique in each field.</p>
<div class="section" id="example-nexus-data-attributes">
<span id="table-exampleattributes"></span><h4>2.1.3.1. Example NeXus Data Attributes<a class="headerlink" href="#example-nexus-data-attributes" title="Permalink to this headline">¶</a></h4>
<p>For the full specification of attributes,
see <a class="reference internal" href="../cheatsheet.html#volume2-nxdl-section"><em>volume2.NXDL.section (not converted yet)</em></a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="14%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Name</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>units</td>
<td>NX_CHAR</td>
<td>Data units, given as character strings,
must conform to the NeXus units standard.
See the &#8220;NeXus units&#8221; section
for details.</td>
</tr>
<tr><td>signal</td>
<td>NX_INT</td>
<td>Defines which data set contains the
signal to be plotted use <cite>signal=&#8221;1&#8221;</cite>
for main signal</td>
</tr>
<tr><td>axes</td>
<td>NX_CHAR</td>
<td>Defines the names of the dimension
scales for this data set as a
colon-delimited list. For example,
suppose data is an array with elements
<cite>data[j][i]</cite> (C)
or <cite>data(i,j)</cite> (Fortran), with
dimension scales <cite>time_of_flight[i]</cite>
and <cite>polar_angle[j]</cite>, then data would
have an attribute
<cite>axes=&#8221;polar_angle:time_of_flight&#8221;</cite>
in addition to an attribute
<cite>signal=&#8221;1&#8221;</cite>.</td>
</tr>
<tr><td>axis</td>
<td>NX_INT</td>
<td>The original way of designating data
for plotting, now superceded by the
axes attribute. This defines the rank
of the signal data for which this data
set is a dimension scale in order of
the fastest varying index (see a longer
discussion in the section on NXdata
<a class="reference internal" href="../cheatsheet.html#nxdata-structure"><em>nxdata-structure (not converted yet)</em></a>
structure),
i.e. if the array being stored is data,
with elements <cite>data[j][i]</cite> in C and
<cite>data(i,j)</cite> in Fortran, axis would
have the following values:
ith dimension (<cite>axis=&#8221;1&#8221;</cite>),
jth dimension (<cite>axis=&#8221;2&#8221;</cite>), etc.</td>
</tr>
<tr><td>primary</td>
<td>NX_INT32</td>
<td>Defines the order of preference for
dimension scales which apply to the
same rank of signal data. Use
<cite>primary=&#8221;1&#8221;</cite> to indicate preferred
dimension scale</td>
</tr>
<tr><td>long_name</td>
<td>NX_CHAR</td>
<td>Defines title of signal data or
axis label of dimension scale</td>
</tr>
<tr><td>calibration_status</td>
<td>NX_CHAR</td>
<td>Defines status of data value.
Set to &#8220;Nominal&#8221; or &#8220;Measured&#8221;</td>
</tr>
<tr><td>offset</td>
<td>NX_INT</td>
<td>Rank values off offsets to use for
each dimension if the data is not in
C storage order</td>
</tr>
<tr><td>stride</td>
<td>NX_INT</td>
<td>Rank values of steps to use when
incrementing the dimension</td>
</tr>
<tr><td>transformation_type</td>
<td>NX_CHAR</td>
<td>translation or totation</td>
</tr>
<tr><td>vector</td>
<td>NX_FLOAT</td>
<td>3 values describing the axis of
rotation or the direction of translation</td>
</tr>
<tr><td>interpretation</td>
<td>NX_CHAR</td>
<td>Describes how to display the data.
Allowed values include:
scaler (0-D data),
spectrum (1-D data),
image (2-D data),
or vertex (3-D data).</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="nexus-file-global-attributes">
<span id="table-globalattributes"></span><h4>2.1.3.2. NeXus File Global Attributes<a class="headerlink" href="#nexus-file-global-attributes" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="15%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Name</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>file_name</td>
<td>NX_CHAR</td>
<td>File name of original NeXus file to
assist in identification if the external
name has been changed</td>
</tr>
<tr><td>file_time</td>
<td>ISO 8601</td>
<td>Date and time of file creation</td>
</tr>
<tr><td>file_update_time</td>
<td>ISO 8601</td>
<td>Date and time of last file change
at close</td>
</tr>
<tr><td>NeXus_version</td>
<td>NX_CHAR</td>
<td>Version of NeXus API used in writing
the file</td>
</tr>
<tr><td>creator</td>
<td>NX_CHAR</td>
<td>Facility or program where the file
originated</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="data-links">
<span id="design-links"></span><h3>2.1.4. Data Links<a class="headerlink" href="#data-links" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-11"></span><p id="index-12">Links are pointers to existing data somewhere else.
The concept is very much like
symbolic links in a unix filesystem.
The NeXus definition sometimes requires
access to the same data in different groups
within the same file.
For example: detector data is stored in the
<tt class="docutils literal"><span class="pre">NXinstrument/NXdetector</span></tt> group
but may be needed in <tt class="docutils literal"><span class="pre">NXdata</span></tt> for automatic plotting.
Rather then replicating the data, NeXus uses
links in such situations. See the figure <a class="reference internal" href="#fig-data-linking"><em>Linking in a NeXus file</em></a> for
a more descriptive representation of the concept of linking.</p>
<div class="section" id="linking-in-a-nexus-file">
<span id="fig-data-linking"></span><h4>2.1.4.1. Linking in a NeXus file<a class="headerlink" href="#linking-in-a-nexus-file" title="Permalink to this headline">¶</a></h4>
<div class="figure">
<img alt="../_images/data-linking.png" src="../_images/data-linking.png" style="width: 400pt;" />
<p class="caption">Linking in a NeXus file.
See example code below: <a class="reference internal" href="../cheatsheet.html#example-data-linking"><em>example.data-linking (not converted yet)</em></a></p>
</div>
</div>
</div>
<div class="section" id="nexus-classes">
<span id="design-nexusclasses"></span><h3>2.1.5. NeXus Classes<a class="headerlink" href="#nexus-classes" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-13"></span><p id="index-14">Data groups often describe objects in the experiment (monitors, detectors,
monochromators, etc.), so that the contents (both data fields and/or other data
groups) comprise the properties of that object. NeXus has defined a set of standard
objects, or base classes, out of which a NeXus file can be constructed. This is each data group
is identified by a name and a class. The group class, defines the type of object
and the properties that it can contain, whereas the group name defines a unique instance
of that class. These classes are
defined in XML using the NeXus Definition Language (NXDL)
format. All NeXus class types adopted by the NIAC <em>must</em>
begin with <cite>NX</cite>.
Classes not adopted by the NIAC <em>must not</em>
start with <cite>NX</cite>.</p>
<p id="index-15">Not all classes define physical objects. Some refer to logical groupings of
experimental information, such as plottable data,
sample environment logs, beam
profiles, etc.
There can be multiple instances of each class. On
the other hand, a typical NeXus file will only contain a small subset of the
possible classes.</p>
<p>NeXus base classes are not proper classes in the
same sense as used in object oriented programming
languages. In fact the use of the term classes is
actually misleading but has established itself
during the development of NeXus. NeXus base
classes are rather dictionaries of field names
and their meanings which are permitted in a
particular NeXus group implementing the NeXus
class. This sounds complicated but becomes easy
if you consider that most NeXus groups describe
instrument components. Then for example, a
<cite>NXmonochromator</cite> base class describes all the
possible field names which NeXus allows to be
used to describe a monochromator.</p>
<p>Most NeXus base classes represent instrument components.
Some are used as containers to structure information in a
file (<cite>NXentry</cite>, <cite>NXcollection</cite>, <cite>NXinstrument</cite>,
<cite>NXprocess</cite>, <cite>NXparameter</cite>). But there are some base
classes which have special uses which need to be
mentioned here:</p>
<dl class="docutils">
<dt><cite>NXdata</cite></dt>
<dd><cite>NXdata</cite> is used to identify the default plottable data.
The notion of a default plot of data is a basic
motivation of NeXus.</dd>
<dt><cite>NXlog</cite></dt>
<dd><cite>NXlog</cite> is used to store time stamped data like the
log of a temperature controller. Basically you give
a start time, and arrays with a difference in seconds
to the start time and the values read.</dd>
<dt><cite>NXnote</cite></dt>
<dd><cite>NXnote</cite> provides a place to store general notes,
images, video or whatever. A mime type is stored
together with a binary blob of data. Please use this
only for auxiliary information, for example an image
of your sample, or a photo of your boss.</dd>
<dt><cite>NXgeometry</cite></dt>
<dd><cite>NXgeometry</cite> and its subgroups <cite>NXtranslation</cite>,
<cite>NXorientation</cite>, <cite>NXshape</cite> are used to store absolute
positions in the laboratory coordinate system or to
define shapes.</dd>
</dl>
<p>These groups can appear anywhere in the NeXus hierarchy,
where needed. Preferably close to the component they
annotate or in a <cite>NXcollection</cite>. All of the base classes
are documented in the reference manual.</p>
<div class="section" id="nxdata-facilitates-automatic-plotting">
<span id="nxdata-facilitates-thedefaultplot"></span><h4>2.1.5.1. <cite>NXdata</cite> Facilitates Automatic Plotting<a class="headerlink" href="#nxdata-facilitates-automatic-plotting" title="Permalink to this headline">¶</a></h4>
<span class="target" id="index-16"></span><span class="target" id="index-17"></span><p id="index-18">The most notable special base class
(also known as <em>group</em>) in NeXus is <cite>NXdata</cite>.
<cite>NXdata</cite> is the answer to a basic motivation of NeXus
to facilitate automatic plotting of data.
<cite>NXdata</cite> is designed to contain the main dataset
and its associated dimension scales (axes) of a
NeXus data file. The usage scenario is that an
automatic data plotting program just opens a
<cite>NXentry</cite> and then continues to search for any
<cite>NXdata</cite> groups. These <cite>NXdata</cite> groups represent
the plottable data.  Here is the way an
automatic plotting program ought to work:</p>
<ol class="arabic simple">
<li>Search for NXentry groups</li>
<li>Open an NXentry</li>
<li>Search for NXdata groups</li>
<li>Open an NXdata group</li>
<li>Identify the plottable data.</li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li>Search for a dataset with attribute <cite>signal=1</cite>.
This is your main dataset.
(There should be only one dataset that matches.)</li>
<li>Try to read the axes attribute of the
main dataset, if it exists.</li>
</ol>
<blockquote>
<div><ol class="lowerroman simple">
<li>The value of axes is a colon- or
comma-separated list of the datasets describing
the dimension scales
(such as <cite>axes=&#8221;polar_angle:time_of_flight&#8221;</cite>).</li>
<li>Parse axes and open the datasets to describe
your dimension scales</li>
</ol>
</div></blockquote>
<ol class="arabic simple">
<li>If axes does not exist:</li>
</ol>
<blockquote>
<div><ol class="lowerroman simple">
<li>Search for datasets with attributes
<cite>axis=1</cite>, <cite>axis=2</cite>, etc.
These are the datasets describing your axis.
There may be several datasets for any axis,
i.e. there may be multiple datasets with
the attribute <cite>axis=1</cite>. Among them the
dataset with the attribute <cite>primary=1</cite> is
the preferred one. All others are
alternative dimension scales.</li>
<li>Open the datasets to describe
your dimension scales.</li>
</ol>
</div></blockquote>
</div></blockquote>
<ol class="arabic simple">
<li>Having found the default plottable data
and its dimension scales: make the plot</li>
</ol>
</div>
</div>
<div class="section" id="nexus-application-definitions">
<span id="design-nexusapplications"></span><h3>2.1.6. NeXus Application Definitions<a class="headerlink" href="#nexus-application-definitions" title="Permalink to this headline">¶</a></h3>
<p>The objects described so far provide us with the means to
store data from a wide variety of instruments, simulations
or processed data as resulting from data analysis.
But NeXus strives to express strict standards for certain
applications of NeXus too. The tool which NeXus uses for
the expression of such strict standards is the NeXus
Application Definition. A NeXus Application Definition
describes which groups and data items have to be present
in a file in order to properly describe an application
of NeXus. For example for describing a powder diffraction
experiment. Typically an application definition will contain
only a small subset of the many groups and fields defined
in NeXus. NeXus application definitions are also expressed
in the NeXus Definition Language (NXDL). A tool exists which
allows to validate a NeXus file against a given
application definition.</p>
<p>Another way to look at a NeXus application definition
is as a contract between a file writer and a file consumer
(reader). A contract which reads:
<em>If you write your files
following a particular NeXus application definition,
I can process these files with my software</em>.</p>
<p>Yet another way to look at a NeXus application definition
is to understand it as an interface definition between data
files and the software which uses this file. Much like an
interface in the Java or other modern object oriented
programming languages.</p>
<p>In contrast to NeXus base classes, NeXus supports inheritance
in application definitions.</p>
<p>Please note that a NeXus Application Definition will only
define the bare minimum of data necessary to perform common
analysis with data. Practical files will nearly always
contain more data. One of the beauties of NeXus is that it
is always possible to add more data to a file without breaking
its compliance with its application definition.</p>
</div>
<div class="section" id="nexus-coordinate-systems">
<span id="design-coordinatesystem"></span><h3>2.1.7. NeXus Coordinate Systems<a class="headerlink" href="#nexus-coordinate-systems" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-19"></span><span class="target" id="index-20"></span><p id="index-21">Coordinate systems in NeXus underwent quite some development.
Initially, just positions of relevant motors were
stored without further standardization. This soon proved to
be too little and the <em>NeXus polar coordinate</em> system was
developed. This system still is very close to angles
meaningful to an instrument scientist but allows to define
general positions of components easily. Then users from the
simulation community approached the NeXus team and asked for
a means to store absolute coordinates. This was implemented
through the use of the <cite>NXgeometry</cite> class on top of the
<em>McStas</em> <a class="footnote-reference" href="#mcstas" id="id2">[1]</a>
system. We soon learned that all the things we do
can be expressed through the McStas coordinate system.
So the McStas coordinate system
became the reference coordinate system for NeXus.
<cite>NXgeometry</cite> was expanded to allow the description of shapes
when the demand came up.
Later members of the CIF <a class="footnote-reference" href="#cif" id="id3">[2]</a> team
convinced the NeXus team of the beauty of transformation
matrices and NeXus was enhanced to store the necessary
information to fully map CIF concepts. Not much had to be
changed though as we choose to document the existing angles
in CIF terms. The CIF system allows to store arbitrary
operations and nevertheless calculate absolute coordinates in
the laboratory coordinate system. It also allows to convert
from local, for example detector coordinate systems, to
absolute coordinates in the laboratory system.</p>
<table class="docutils footnote" frame="void" id="mcstas" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id2">1</a>, <a class="fn-backref" href="#id4">2</a>)</em> McStas, <a class="reference external" href="http://www.mcstas.org">http://www.mcstas.org</a>, also <a class="reference external" href="http://mcstas.risoe.dk">http://mcstas.risoe.dk</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="cif" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td>CIF (Crystallographic Information Framework), <a class="reference external" href="http://www.iucr.org/resources/cif">http://www.iucr.org/resources/cif</a></td></tr>
</tbody>
</table>
<div class="section" id="mcstas-and-nxgeometry-system">
<span id="design-coordinate-nxgeometry"></span><h4>2.1.7.1. McStas and <cite>NXgeometry</cite> System<a class="headerlink" href="#mcstas-and-nxgeometry-system" title="Permalink to this headline">¶</a></h4>
<span class="target" id="index-22"></span><p id="index-23">NeXus uses the <em>McStas coordinate system</em> <a class="footnote-reference" href="#mcstas" id="id4">[1]</a>
as its laboratory coordinate system.
The instrument is given a global, absolute coordinate system where:</p>
<ul class="simple">
<li>the <em>z</em> axis points in the direction of the incident beam,</li>
<li>the <em>x</em> axis is perpendicular to the beam in the horizontal
plane pointing left as seen from the source</li>
<li>the <em>y</em> axis points upwards.</li>
</ul>
<p>See below for a drawing of the McStas coordinate system.  The origin of this
coordinate system is the sample position or, if this is ambiguous, the center of the sample holder
with all angles and translations set to zero.
The McStas coordinate system is
illustrated in figure <a class="reference internal" href="#fig-mcstasccord"><em>The McStas Coordinate System</em></a>.</p>
<div class="figure" id="fig-mcstasccord">
<img alt="../_images/mcstascoord.png" src="../_images/mcstascoord.png" style="width: 400pt;" />
<p class="caption">The McStas Coordinate System</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The NeXus definition of <cite>+z</cite> is opposite to that
in the International Tables for Crystallography,
volume G, <a class="footnote-reference" href="#iucr-g" id="id5">[3]</a> and consequently, <cite>+x</cite> is also reversed.</p>
<table class="last docutils footnote" frame="void" id="iucr-g" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[3]</a></td><td><strong>International Tables for Crystallography</strong>
<em>Volume G: Definition and exchange of crystallographic data</em>.
Sydney Hall and Brian McMahon, Editors.
Published for the IUCr by Springer, 2005
ISBN 1-4020-3138-6, 594 + xii pages</td></tr>
</tbody>
</table>
</div>
<p>The NeXus <cite>NXgeometry</cite> class directly uses the McStas
coordinate system. <cite>NXgeometry</cite> classes can appear in any
component in order to specify its position. The suggested
name to use is geometry. In <cite>NXgeometry</cite> the
<cite>NXtranslation/values</cite> field defines the absolute position of
the component in the McStas coordinate system. The
<cite>NXorientation/value</cite> field describes the orientation of the
component as a vector of in the McStas coordinate system.</p>
</div>
<div class="section" id="simple-spherical-polar-coordinate-system">
<span id="design-coordinate-spherical"></span><h4>2.1.7.2. Simple (Spherical Polar) Coordinate System<a class="headerlink" href="#simple-spherical-polar-coordinate-system" title="Permalink to this headline">¶</a></h4>
<p id="index-24">In this system, the instrument is considered as a set of
components through which the incident beam passes. The
variable <strong>distance</strong> is assigned to each component and
represents the effective beam flight path length between this
component and the sample. A sign convention is used where
negative numbers represent components pre-sample and positive
numbers components post-sample. At each component there is
local spherical coordinate system with the angles
<em>polar_angle</em> and <em>azimuthal_angle</em>. The size of the sphere
is the distance to the previous component.</p>
<p>In order to understand this spherical polar coordinate system
it is helpful to  look initially at the common condition that
azimuthal_angle is zero. This corresponds to working directly
in the horizontal scattering plane of the instrument. In this
case polar_angle maps directly to the setting commonly known
as two theta. Now, there are instruments where components
live outside of the scattering plane. Most notably detectors.
In order to describe such components we first apply the tilt
out of the horizontal scattering plane as the
azimuthal_angle. Then, in this tilted plane, we rotate to the
component. The beauty of this is that polar_angle is always
two theta. Which, in the case of a component out of the
horizontal scattering plane, is not identical to the value
read from the motor responsible for rotating the component.
This situation is shown in figure
<a class="reference internal" href="#fig-polar-geometry-figure"><em>NeXus Simple (Spherical Polar) Coordinate System</em></a>.</p>
<div class="figure" id="fig-polar-geometry-figure">
<img alt="../_images/polplane.png" src="../_images/polplane.png" style="width: 200pt;" />
<p class="caption">NeXus Simple (Spherical Polar) Coordinate System</p>
</div>
</div>
<div class="section" id="coordinate-transformations">
<span id="coordinatetransformations"></span><h4>2.1.7.3. Coordinate Transformations<a class="headerlink" href="#coordinate-transformations" title="Permalink to this headline">¶</a></h4>
<p id="index-25">Another way to look at coordinates is through the use of transformation matrices.
In this world view, the absolute position of a component or a detector pixel with respect to
the laboratory corrdinate system is calculated by applying a series of translations and
rotations. These operations are commonly expressed as transformation matrices and their
combination as matrix multiplication. A very important aspect is that the order of application
of the individual operations <em>does</em> matter. Another important aspect is that
any operation transforms the whole coordinate system and gives rise to a new local coordinate system.
The mathematics behind this is
well known and used in such applications such as industrial robot control, space flight and
computer games. The beauty in this comes from the fact that the operations to apply map easily
to instrument settings and constants. It is also easy to analyze the contribution of each individual
operation: this can be studied under the condition that all other operations are at a zero setting.</p>
<p>In order to use coordinate transformations, several morsels of information need to be known:</p>
<dl class="docutils">
<dt>Type</dt>
<dd>The type of operation: rotation or translation</dd>
<dt>Direction</dt>
<dd>The direction of the translation or the direction of the rotation axis</dd>
<dt>Value</dt>
<dd>The angle of rotation or the length of the translation</dd>
<dt>Order</dt>
<dd>The order of operations to apply to move a component into its place.</dd>
</dl>
<div class="section" id="actions-of-standard-nexus-fields">
<span id="tb-table-transform"></span><h5>2.1.7.3.1. Actions of standard NeXus fields<a class="headerlink" href="#actions-of-standard-nexus-fields" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="37%" />
<col width="31%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Field Name</th>
<th class="head">transformation_type</th>
<th class="head">vector</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>polar_angle</td>
<td>rotation</td>
<td>0 1 0</td>
</tr>
<tr><td>azimuthal_angle</td>
<td>rotation</td>
<td>0 0 1</td>
</tr>
<tr><td>meridional_angle</td>
<td>rotation</td>
<td>1 0 0</td>
</tr>
<tr><td>distance</td>
<td>translation</td>
<td>0 0 1</td>
</tr>
<tr><td>height</td>
<td>translation</td>
<td>0 1 0</td>
</tr>
<tr><td>x_translation</td>
<td>translation</td>
<td>1 0 0</td>
</tr>
<tr><td>chi</td>
<td>rotation</td>
<td>0 0 1</td>
</tr>
<tr><td>phi</td>
<td>rotation</td>
<td>0 1 0</td>
</tr>
</tbody>
</table>
<p>The type and direction of the NeXus standard operations is documented in table <a class="reference internal" href="#tb-table-transform"><em>Actions of standard NeXus fields</em></a>.
NeXus can now also allow non standard operations to be stored in data files. In such cases additional data
attributes are required which describe the operation. These are <em>transformation_type</em> which
can be either translation or rotation. The other is <em>vector</em> which is 3 float values describing
the direction of translation or rotation. The value is of course always the value of the data field in the data file.</p>
<p>How NeXus describes the order of operations to apply has not yet been decided upon. The authors favorite scheme
is to use a special field at each instrument component, named <em>transform</em> which describes the
operations to apply to get the component into its position as a list of colon separated paths to the operations
to apply relative to the current <cite>NXentry</cite>. For paths in the same group, only the name need to be given. Detectors
may need two such fields: the transfrom field to get the detector as a whole into its position
and a <em>transform_pixel</em> field which describes how the absolute position of a detector pixel
can be calculated.</p>
<p>For the NeXus spherical coordinate system, the order is implicit and is given by:</p>
<div class="highlight-python"><pre>azimuthal_angle:polar_angle:distance</pre>
</div>
<p>This is also a nice example of the application of transformation matrices:</p>
<ol class="arabic simple">
<li>You first apply azimuthal_angle as a rotation around <em>z</em>.
This rotates the whole coordinate out of the plane.</li>
<li>Then you apply polar_angle as a rotation around <em>y</em>
in the tilted coordinate system.</li>
<li>This also moves the direction of the <em>z</em> vector.
Along which you translate the component to place by distance.</li>
</ol>
<div class="section" id="rules-for-storing-data-items-in-nexus-files">
<span id="datarules"></span><h6>2.1.7.3.1.1. Rules for Storing Data Items in NeXus Files<a class="headerlink" href="#rules-for-storing-data-items-in-nexus-files" title="Permalink to this headline">¶</a></h6>
<p>This section describes the rules which apply for storing single data fields in data files.</p>
</div>
</div>
</div>
<div class="section" id="naming-conventions">
<span id="design-naming"></span><h4>2.1.7.4. Naming Conventions<a class="headerlink" href="#naming-conventions" title="Permalink to this headline">¶</a></h4>
<span class="target" id="index-26"></span><p id="index-27">Group and field names used within NeXus follow a naming
convention which adheres to these rules.
The names of NeXus <em>group</em> and <em>field</em> objects
must contain only a restricted set of characters.
This set may be described by this regular expression syntax.</p>
<div class="highlight-python" id="regexpname"><pre>[A-Za-z_][\w_]*</pre>
</div>
<p>This name pattern starts with a letter (upper or lower case)
or &#8220;<cite>_</cite>&#8221; (underscore), then letters,
numbers, and &#8220;<cite>_</cite>&#8221; and is limited to no more than 63 characters
(imposed by the HDF5 rules for names).</p>
<p>Sometimes it is necessary to combine words in order to
build a descriptive name for a data field or a group.
In such cases lowercase words are connected by underscores.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">number_of_lenses</span>
</pre></div>
</div>
<p>For all data fields, only names from the NeXus base class dictionaries are to
be used. <a class="footnote-reference" href="#id7" id="id6">[4]</a>
If a data field name or even a complete component is missing,
please suggest the addition to the NIAC. The addition will usually be
accepted provided it is not a duplication of an existing field and
adequately documented.</p>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[4]</a></td><td>The NeXus base classes provide a comprehensive dictionary
of terms than can be used for each class.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="nexus-storage">
<span id="design-nexusdimensions"></span><h4>2.1.7.5. NeXus Storage<a class="headerlink" href="#nexus-storage" title="Permalink to this headline">¶</a></h4>
<p id="index-28">NeXus stores multi dimensional arrays of physical values in C language storage order,
last dimension is the fastest varying. This is the rule.
<strong>Good reasons are required to deviate from this rule.</strong></p>
<p>One good reason to deviate from this rule is the situation
where data must be streamed to disk as fast as possible and
a conversion to NeXus storage order is not possible.
In such cases, exceptions can be made. It is possible
to store data in other storage orders in NeXus
as well as to specify that the data needs to be converted first
before being useful.</p>
<div class="section" id="non-c-storage-order">
<span id="design-noncstorageorder"></span><h5>2.1.7.5.1. Non C Storage Order<a class="headerlink" href="#non-c-storage-order" title="Permalink to this headline">¶</a></h5>
<p id="index-29">In order to indicate that the storage order
is different from C storage order two
additional data set attributes, offset and stride,
have to be stored which together define the storage
layout of the data. Offset and stride contain rank
numbers according to the rank of the multidimensional
data set. Offset describes the step to make when the
dimension is multiplied by 1. Stride defines the step to
make when incrementing the dimension.
This is best explained by some examples.</p>
</div>
</div>
</div>
<div class="section" id="offset-and-stride-for-1-d-data">
<h3>2.1.8. Offset and Stride for 1-D data<a class="headerlink" href="#offset-and-stride-for-1-d-data" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>* raw data = 0 1 2 3 4 5 6 7 8 9
   size[1] = { 10 }  // assume uniform overall array dimensions

* default stride:
   stride[1] = { 1 }
   offset[1] = { 0 }
   for i:
      result[i]:
         0 1 2 3 4 5 6 7 8 9

* reverse stride:
   stride[1] = { -1 }
   offset[1] = { 9 }
   for i:
      result[i]:
         9 8 7 6 5 4 3 2 1 0</pre>
</div>
</div>
<div class="section" id="offset-and-stride-for-2-d-data">
<h3>2.1.9. Offset and Stride for 2-D data<a class="headerlink" href="#offset-and-stride-for-2-d-data" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>* raw data = 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19
   size[2] = { 4, 5 }  // assume uniform overall array dimensions

* row major (C) stride:
   stride[2] = { 5, 1 }
   offset[2] = { 0, 0 }
   for i:
      for j:
         result[i][j]:
            0 1 2 3 4
            5 6 7 8 9
            10 11 12 13 14
            15 16 17 18 19

* column major (Fortran) stride:
   stride[2] = { 1, 4 }
   offset[2] = { 0, 0 }
   for i:
      for j:
         result[i][j]:
            0 4 8 12 16
            1 5 9 13 17
            2 6 10 14 18
            3 7 11 15 19

* "crazy reverse" row major (C) stride:
   stride[2] = { -5, -1 }
   offset[2] = { 4, 5 }
   for i:
      for j:
         result[i][j]:
            19 18 17 16 15
            14 13 12 11 10
            9 8 7 6 5
            4 3 2 1 0</pre>
</div>
</div>
<div class="section" id="offset-and-stride-for-3-d-data">
<h3>2.1.10. Offset and Stride for 3-D data<a class="headerlink" href="#offset-and-stride-for-3-d-data" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>* raw data = 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19
      20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39
      40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59
   size[3] = { 3, 4, 5 }  // assume uniform overall array dimensions

* row major (C) stride:
   stride[3] = { 20, 5, 1 }
   offset[3] = { 0, 0, 0 }
   for i:
      for j:
         for k:
            result[i][j][k]:
               0 1 2 3 4
               5 6 7 8 9
               10 11 12 13 14
               15 16 17 18 19

               20 21 22 23 24
               25 26 27 28 29
               30 31 32 33 34
               35 36 37 38 39

               40 41 42 43 44
               45 46 47 48 49
               50 51 52 53 54
               55 56 57 58 59

* column major (Fortran) stride:
   stride[3] = { 1, 3, 12 }
   offset[3] = { 0, 0, 0 }
   for i:
      for j:
         for k:
            result[i][j][k]:
               0 12 24 36 48
               3 15 27 39 51
               6 18 30 42 54
               9 21 33 45 57

               1 13 25 37 49
               4 16 28 40 52
               7 19 31 43 55
               10 22 34 46 58

               2 14 26 38 50
               5 17 29 41 53
               8 20 32 44 56
               11 23 35 47 59</pre>
</div>
</div>
<div class="section" id="data-value-transformations">
<span id="design-datavaluetransformations"></span><h3>2.1.11. Data Value Transformations<a class="headerlink" href="#data-value-transformations" title="Permalink to this headline">¶</a></h3>
<p>It is possible to store raw values in NeXus data files. Such data has to be stored in
special <cite>NXformula</cite> <a class="footnote-reference" href="#id9" id="id8">[5]</a> groups together with the data and information required to transform
it into physical values.</p>
<table class="docutils footnote" frame="void" id="id9" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[5]</a></td><td>NeXus has not yet defined the <cite>NXformula</cite> group (or base class) for use in NeXus data files.
The exact content of the <cite>NXformula</cite> group is still under discussion.</td></tr>
</tbody>
</table>
<div class="section" id="nexus-data-types">
<span id="design-datatypes"></span><h4>2.1.11.1. NeXus Data Types<a class="headerlink" href="#nexus-data-types" title="Permalink to this headline">¶</a></h4>
<p>Matching regular expressions for NeXus data types</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">description</th>
<th class="head">matching regular expression</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>integer</td>
<td><tt class="docutils literal"><span class="pre">NX_INT(8|16|32|64)</span></tt></td>
</tr>
<tr><td>floating-point</td>
<td><tt class="docutils literal"><span class="pre">NX_FLOAT(32|64)</span></tt></td>
</tr>
<tr><td>array</td>
<td><tt class="docutils literal"><span class="pre">(\[0-9\])?</span></tt></td>
</tr>
<tr><td>valid item name</td>
<td><tt class="docutils literal"><span class="pre">^[A-Za-z_][A-Za-z0-9_]*$</span></tt></td>
</tr>
<tr><td>valid class name</td>
<td><tt class="docutils literal"><span class="pre">^NX[A-Za-z0-9_]*$</span></tt></td>
</tr>
</tbody>
</table>
<p>NeXus supports numeric data as either integer or floating-point
numbers.  A number follows that indicates the number of bits in the word.
The table above shows the regular expressions that
matches the data type specifier.</p>
<dl class="docutils">
<dt>integers</dt>
<dd><cite>NX_INT8</cite>, <cite>NX_INT16</cite>, <cite>NX_INT32</cite>, or <cite>NX_INT64</cite></dd>
<dt>floating-point numbers</dt>
<dd><cite>NX_FLOAT32</cite> or <cite>NX_FLOAT64</cite></dd>
<dt>date / time stamps</dt>
<dd><p class="first"><cite>NX_DATE_TIME</cite> or <cite>ISO8601</cite></p>
<p class="last" id="index-30">Dates and times are specified using
ISO-8601 standard definitions.
Refer to <a class="reference internal" href="#design-dates-times"><em>NeXus dates and times</em></a>.</p>
</dd>
<dt>strings</dt>
<dd><p class="first">All strings are to be encoded in UTF-8. Since most strings in a
NeXus file are restricted to a small set of characters and the first 128 characters are standard across encodings,
the encoding of most of the strings in a NeXus file will be a moot point.
Where encoding in UTF-8 will be important is when recording peoples names in <cite>NXuser</cite>
and text notes in <cite>NXnotes</cite>.</p>
<p class="last" id="index-31">Because the few places where encoding is important also have unpredictable content, as well as the way in which
current operating systems handle character encoding, it is practically impossible to test the encoding used. Hence,
<cite>nxvalidate</cite> provides no messages relating to character encoding.</p>
</dd>
<dt>binary data</dt>
<dd>Binary data is to be written as <cite>UINT8</cite>.</dd>
<dt>images</dt>
<dd>Binary image data is to be written using <cite>UINT8</cite>,
the same as binary data, but with an accompanying image mime-type.
If the data is text, the line terminator is [CR][LF].</dd>
</dl>
</div>
<div class="section" id="nexus-dates-and-times">
<span id="design-dates-times"></span><h4>2.1.11.2. NeXus dates and times<a class="headerlink" href="#nexus-dates-and-times" title="Permalink to this headline">¶</a></h4>
<div class="sidebar" id="index-32">
<p class="first sidebar-title">Note:</p>
<p class="last">The <cite>T</cite> appears literally in the string,
to indicate the beginning of the time element, as specified
in ISO 8601.  It is common to use a space in place of the <cite>T</cite>.
While human-readable, compatibility with the ISO 8601 standard is not
assured with this substitution.</p>
</div>
<p>NeXus dates and times should be stored using the
ISO 8601 <a class="footnote-reference" href="#iso8601" id="id10">[6]</a> format, such as:</p>
<div class="highlight-python"><pre>1996-07-31T21:15:22+0600</pre>
</div>
<p>The standard also allows for time intervals in fractional seconds
with <em>1 or more digits of precision</em>.
This avoids confusion, e.g. between U.S. and European conventions,
and is appropriate for machine sorting.</p>
<table class="docutils footnote" frame="void" id="iso8601" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[6]</a></td><td>ISO 8601, <a class="reference external" href="http://www.w3.org/TR/NOTE-datetime">http://www.w3.org/TR/NOTE-datetime</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="nexus-units">
<span id="design-units"></span><h4>2.1.11.3. NeXus Units<a class="headerlink" href="#nexus-units" title="Permalink to this headline">¶</a></h4>
<span class="target" id="index-33"></span><p>Given the plethora of possible applications of NeXus, it is difficult to
define units
to use. Therefore, the general rule is that you are free to
store data in any unit you find fit. However, any data field must have a
units attribute which describes the units, Wherever possible, SI units are
preferred. NeXus units are written as a string attribute (<cite>NX_CHAR</cite>)
and describe the engineering units. The string
should be appropriate for the value.
Values for the NeXus units must be specified in
a format compatible with Unidata UDunits. <a class="footnote-reference" href="#udunits" id="id11">[7]</a>
The UDunits specification also includes instructions  for derived units.
At present, the contents of NeXus <cite>units</cite> attributes
are not validated in data files.
Application definitions may specify units to be used for fields
using an  <cite>enumeration</cite>.</p>
<table class="docutils footnote" frame="void" id="udunits" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id11">[7]</a></td><td>Unidata UDunits, <a class="reference external" href="http://www.unidata.ucar.edu/software/udunits/udunits-2-units.html">http://www.unidata.ucar.edu/software/udunits/udunits-2-units.html</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="linking-multi-dimensional-data-with-axis-data">
<h4>2.1.11.4. Linking Multi Dimensional Data with Axis Data<a class="headerlink" href="#linking-multi-dimensional-data-with-axis-data" title="Permalink to this headline">¶</a></h4>
<span class="target" id="index-34"></span><p id="index-35">NeXus allows to store multi dimensional arrays of data.
In most cases
it is not sufficient to just have the indices into the array as a label for
the dimensions of the data. Usually the information which physical value
corresponds to an index into a dimension of the multi dimensional data set.
To this purpose a means is needed to locate appropriate data arrays which describe
what each dimension of a multi dimensional data set actually corresponds too.
There is a standard HDF facility to do this: it is called dimension scales.
Unfortunately, at a time, there was only one global namespace for dimension scales.
Thus NeXus had to come up with its own scheme for locating axis data which is described
here. A side effect of the NeXus scheme is that it is possible to have multiple
mappings of a given dimension to physical data. For example a TOF data set can have the TOF
dimension as raw TOF or as energy.</p>
<span class="target" id="index-36"></span><p id="index-37">There are two methods of linking
each data dimension to its respective dimension scale.
The preferred method uses the <cite>axes</cite> attribute
to specify the names of each dimension scale.
The original method uses the <cite>axis</cite> attribute to identify
with an integer the axis whose value is the number of the dimension.
After describing each of these methods, the two methods will be compared.
A prerequisite for both methods is that the data fields describing the axis
are stored together with the multi dimensional data set whose axes need to be defined
in the same NeXus group. If this leads to data duplication, use links.</p>
<div class="section" id="linking-by-name-using-the-axes-attribute">
<span id="design-linking-byname"></span><h5>2.1.11.4.1. Linking by name using the <cite>axes</cite> attribute<a class="headerlink" href="#linking-by-name-using-the-axes-attribute" title="Permalink to this headline">¶</a></h5>
<span class="target" id="index-38"></span><p id="index-39">The preferred method is to define an attribute of the data itself
called <em>axes</em>.  The <cite>axes</cite> attribute contains the names of
each dimension scale as a colon (or comma) separated list in
the order they appear in C.  For example:</p>
</div>
</div>
</div>
<div class="section" id="preferred-way-of-denoting-axes">
<h3>2.1.12. Preferred way of denoting axes<a class="headerlink" href="#preferred-way-of-denoting-axes" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>data:NXdata
  time_of_flight = 1500.0 1502.0 1504.0 ...
  polar_angle = 15.0 15.6 16.2 ...
  some_other_angle = 0.0 0.0 2.0 ...
  data = 5 7 14 ...
    @axes = polar_angle:time_of_flight
    @signal = 1</pre>
</div>
</div>
<div class="section" id="linking-by-dimension-number-using-the-axis-attribute">
<span id="design-linkingbydimnumber"></span><h3>2.1.13. Linking by dimension number using the <cite>axis</cite> attribute<a class="headerlink" href="#linking-by-dimension-number-using-the-axis-attribute" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-40"></span><span class="target" id="index-41"></span><p id="index-42">The original method is to define an attribute of each dimension
scale called <em>axis</em>.
It is an integer whose value is the number of
the dimension, in order of fastest varying dimension.
That is, if the array being stored is data with elements
<cite>data[j][i]</cite> in C and
<cite>data(i,j)</cite> in Fortran, where <cite>i</cite> is the
time-of-flight index and <cite>j</cite> is
the polar angle index, the <cite>NXdata</cite> group would contain:</p>
<div class="highlight-python"><pre>data:NXdata
  time_of_flight = 1500.0 1502.0 1504.0 ...
    @axis = 1
    @primary = 1
  polar_angle = 15.0 15.6 16.2 ...
    @axis = 2
    @primary = 1
  some_other_angle = 0.0 0.0 2.0 ...
    @axis = 1
  data = 5 7 14 ...
    @signal = 1</pre>
</div>
<p>The <cite>axis</cite> attribute must
be defined for each dimension scale.
The <cite>primary</cite> attribute is unique to this method of linking.</p>
<span class="target" id="index-43"></span><span class="target" id="index-44"></span><p id="index-45">There are limited circumstances in which more
than one dimension scale
for the same data dimension can be included in the same
<cite>NXdata</cite> group.
The most common is when the dimension scales are
the three components of an
<em>(hkl)</em> scan. In order to
handle this case, we have defined another attribute
of type integer called
<cite>primary</cite> whose value determines the order
in which the scale is expected to be
chosen for plotting, i.e.</p>
<div class="sidebar">
<p class="first sidebar-title">Note:</p>
<p class="last">The <cite>primary</cite> attribute can only be
used with the first method of defining dimension scales
discussed above. In addition to
the <cite>signal</cite> data, this
group could contain a data set of the same rank
and dimensions called <cite>errors</cite>
containing the standard deviations of the data.</p>
</div>
<dl class="docutils">
<dt>1st choice:</dt>
<dd><cite>primary=&#8221;1&#8221;</cite></dd>
<dt>2nd choice:</dt>
<dd><cite>primary=&#8221;2&#8221;</cite></dd>
</dl>
<p>etc.</p>
<p>If there is more than one scale with the same value of the <cite>axis</cite> attribute, one
of them must have set <cite>primary=&#8221;1&#8221;</cite>. Defining the <cite>primary</cite>
attribute for the other scales is optional.</p>
</div>
<div class="section" id="discussion-of-the-two-linking-methods">
<span id="design-linking-discussion"></span><h3>2.1.14. Discussion of the two linking methods<a class="headerlink" href="#discussion-of-the-two-linking-methods" title="Permalink to this headline">¶</a></h3>
<p id="index-46">In general the method using the <cite>axes</cite> attribute on the multi dimensional
data set should be preferred. This leaves the actual axis describing data sets
unannotated and allows them to be used as an axis for other multi dimensional
data.  This is especially a concern as an axis describing a data set may be linked
into another group where it may describe a completely different dimension
of another data set.</p>
<p>Only when alternative axes definitions are needed, the <cite>axis</cite> method
should be used to specify an axis of a data set.  This is shown in the example above for
the <cite>some_other_angle</cite> field where <cite>axis=&#8221;1&#8221;</cite>
denotes another possible primary axis for plotting.  The default
axis for plotting carries the <cite>primary=&#8221;1&#8221;</cite> attribute.</p>
<p id="index-47">Both methods of linking data axes will be supported in NeXus
utilities that identify dimension scales,
such as <cite>NXUfindaxis()</cite>.</p>
<div class="section" id="storing-detectors">
<span id="rules-storingdetectors"></span><h4>2.1.14.1. Storing Detectors<a class="headerlink" href="#storing-detectors" title="Permalink to this headline">¶</a></h4>
<p>There are very different types of detectors out there. Storing their data
can be a challenge. As a general guide line: if the detector has some
well defined form, this should be reflected in the data file. A linear
detector becomes a linear array, a rectangular detector becomes an
array of size <cite>xsize</cite> times <cite>ysize</cite>.
Some detectors are so irregular that this
does not work. Then the detector data is stored as a linear array, with the
index being detector number till <cite>ndet</cite>. Such detectors must be accompanied
by further arrays of length <cite>ndet</cite> which give
<cite>azimuthal_angle, polar_angle and distance</cite> for each detector.</p>
<p>If data from a time of flight (TOF) instrument must be described, then the
TOF dimension becomes the last dimension, for example an area detector of
<cite>xsize</cite> <em>vs.</em> <cite>ysize</cite>
is stored with TOF as an array with dimensions
<cite>xsize, ysize, ntof</cite>.</p>
</div>
<div class="section" id="monitors-are-special">
<span id="rules-storingdata-monitors"></span><h4>2.1.14.2. Monitors are Special<a class="headerlink" href="#monitors-are-special" title="Permalink to this headline">¶</a></h4>
<p id="index-48">Monitors, detectors that measure the properties
of the experimental probe rather than the
sample, have a special place in NeXus files. Monitors are crucial to normalize data.
To emphasize their role, monitors are not stored in the
<cite>NXinstrument</cite> hierarchy but on <cite>NXentry</cite> level
in their own groups as there might be multiple monitors. Of special
importance is the monitor in a group called <cite>control</cite>.
This is the main monitor against which the data has to be normalized.
This group also contains the counting control information,
i.e. counting mode, times, etc.</p>
<p>Monitor data may be multidimensional. Good examples are scan monitors
where a monitor value per scan point is expected or
time-of-flight monitors.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../volume2/index.html" title="NeXus: Reference Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="1. NeXus Introduction"
             >previous</a> |</li>
        <li><a href="../index.html">NeXus: User Guide and Reference Documentation v2011-08 documentation</a> &raquo;</li>
          <li><a href="../contents.html" >Contents</a> &raquo;</li>
          <li><a href="index.html" >NeXus: User Manual</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, http://nexusformat.org.
      Last updated on Sep 12, 2011.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>