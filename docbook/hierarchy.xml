<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbook.rng" type="xml"?>
<!-- # $Id$ -->
<section
	xml:id="Design-HierarchyBaseClasses" 
	version="5.0"
    xmlns="http://docbook.org/ns/docbook" 
    xmlns:xlink="http://www.w3.org/1999/xlink" 
	xmlns:xi="http://www.w3.org/2001/XInclude">
  
    
    <!-- 
        ========================================
        section: Hierarchy of NeXus Base Classes
        ========================================
    -->
        <title>Hierarchy of NeXus Base Classes</title>
        <para>
            A standard NeXus file is composed from a selection of NeXus base 
            classes.
            The particular selection may be guided by a NeXus application 
            definition 
            (see the <link xlink:href="#NXDL">NXDL chapter</link> in Volume II
            for more details)
            but it is not necessary to use an NXDL file to write a NeXus data 
            file.
            The base classes have a hierarchy for their use
            (shown in <xref linkend="list.hierarchy.base"/>)
            and this hierarchy
            <indexterm significance="preferred">
                <primary>hierarchy</primary>
                <secondary>base classes</secondary>
            </indexterm>
            forms the internal structure of all NeXus data files.
            Keep in mind these two very important points:
            <orderedlist>
                <listitem>
                    <para>
                        There can be multiple instances of each class.  
                        They <emphasis>must</emphasis> have different names. 
                        (Required rule of HDF: no exceptions.)
                        <indexterm>
                            <primary>rules</primary>
                            <secondary>HDF</secondary>
                        </indexterm>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        A typical NeXus file contains only a small subset 
                        of the possible base classes.
                    </para>
                </listitem>
            </orderedlist>
            A complete description of each base class is provided in 
            the 
            <link xlink:href="#ClassDefinitions">Class Definitions Chapter</link>
            of Volume II.
            In addition to the hierarchy of classes in 
            <xref linkend="list.hierarchy.base"/>, 
            the groups in <xref linkend="list.additions.base"/> can be added to any group 
            in a NeXus file (from <code>NXentry</code> and below). 
        </para>
        <para>
            Also note that within each level of the hierarchy, the classes may appear in any order.
            HDF will always present them in alphabetical order.  (Indeed, this very point is
            a primary reason that validation relies on the Schematron validation language 
            <indexterm><primary>Schematron</primary></indexterm>
            to transform the NXDL files as an internal step.  
            XML Schema, also called XSD, imposes
            a more rigid structure and requires much more work to build rules
            <indexterm>
                <primary>rules</primary>
                <secondary>XML</secondary>
            </indexterm>
            that permit
            the ordering of the classes presented by HDF.)
        </para>
        <figure xml:id="list.hierarchy.base" xreflabel="Hierarchy of NeXus Base Classes">
            <title>Hierarchy of NeXus Base Classes</title>
             <!--
                content constructed manually from 
                http://www.nexusformat.org/Design#NeXus_Classes 
            -->
            <indexterm>
                <primary>hierarchy</primary>
                <secondary>base classes</secondary>
            </indexterm>
            <itemizedlist>
                <listitem>
                    <para>
                        <link xlink:href="#NXrootSection"
                            ><code>NXroot</code></link>
                        in XML or just <code>root</code> in HDF files.  This is <emphasis>always</emphasis> 
                        the root node of a NeXus data file.
                        Only <code>NXentry</code> group(s) or non-NeXus items may be children of the root element.
                        <itemizedlist>
                            <listitem>
                                <para>
                                    <link xlink:href="#NXentrySection"
                                        ><code>NXentry</code></link>
                                        All the data, including instrument and sample descriptions, which logically 
                                        make up a single scan or measurement. At many facilities, this corresponds 
                                        to the entity that is defined by a single run number, which could be used to 
                                        name the <code>NXentry</code> group. There can be many <code>NXentry</code> 
                                        groups in each NeXus file.  Content defined by a NeXus application definition
                                        may be entered here in a NeXus data file but it is preferred to use
                                        <code>NXsubentry</code> for application definitions.
                                    <itemizedlist>
                                        <listitem><para><link xlink:href="#NXsubentrySection"><code>NXsubentry</code></link>
                                            Content related to one or more NeXus application definitions can be 
                                            as a <code>NXsubentry</code> group in a NeXus data file.  
                                            (An application definition is
                                            actually an <code>NXsubentry</code> where the <code>definition</code> field
                                            supplies the name of the application defined being used.  Here's an example:
                                            <code>&lt;definition version="1.0">NXsas&lt;/definition></code>).  For instruments
                                            with the possibility of more than one scientific purpose
                                            (such as a SAXS/WAXS instrument), this is the logical place for 
                                            the set of application definitions.
                                        </para></listitem>
                                        <listitem><para><link xlink:href="#NXinstrumentSection"><code>NXinstrument</code></link>
                                            The information needed to describe the instrument, technique, or scientific application. 
                                            This group contains other groups that describe instrument components
                                            such as monochromators, choppers, collimators, apertures, positioners, detectors... 
                                            <itemizedlist>
                                                <listitem><para><link xlink:href="#NXapertureSection"><code>NXaperture</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXattenuatorSection"><code>NXattenuator</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXbeam_stopSection"><code>NXbeam_stop</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXbending_magnetSection"><code>NXbending_magnet</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXcollimatorSection"><code>NXcollimator</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXcrystalSection"><code>NXcrystal</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXdetectorSection"><code>NXdetector</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXdisk_chopperSection"><code>NXdisk_chopper</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXfermi_chopperSection"><code>NXfermi_chopper</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXfilterSection"><code>NXfilter</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXflipperSection"><code>NXflipper</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXguideSection"><code>NXguide</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXinsertion_deviceSection"><code>NXinsertion_device</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXmirrorSection"><code>NXmirror</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXmoderatorSection"><code>NXmoderator</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXmonochromatorSection"><code>NXmonochromator</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXpolarizerSection"><code>NXpolarizer</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXpositionerSection"><code>NXpositioner</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXsourceSection"><code>NXsource</code></link></para></listitem>
                                                <listitem><para><link xlink:href="#NXvelocity_selectorSection"><code>NXvelocity_selector</code></link></para></listitem>
                                            </itemizedlist></para></listitem>
                                        <listitem><para><link xlink:href="#NXsampleSection"><code>NXsample</code></link>
                                            The information needed to define the physical state of the sample during the scan,
                                            such as temperature, magnetic field, crystal mosaic...
                                        </para></listitem>
                                        <listitem><para><link xlink:href="#NXmonitorSection"><code>NXmonitor</code></link>
                                            Monitor data, such as counts, integrals, etc. 
                                        </para></listitem>
                                        <listitem><para><link xlink:href="#NXdataSection"><code>NXdata</code></link>
                                            <indexterm><primary>NXdata</primary></indexterm>
                                            The data to be plotted,
                                            <indexterm>
                                                <primary>NeXus basic motivation</primary>
                                                <secondary>default plot</secondary>
                                            </indexterm>
                                            such as a single data set comprising the measurements 
                                            along with the data errors, and the default axis scales and labels required 
                                            to plot the data. There can be more than one <code>NXdata</code> group.
                                            For example, when there are several detector banks producing plottable data,
                                            <indexterm>
                                                <primary>NeXus basic motivation</primary>
                                                <secondary>default plot</secondary>
                                            </indexterm>
                                            separate <code>NXdata</code> groups will be used, each with a different
                                            name.
                                        </para></listitem>
                                        <listitem><para><link xlink:href="#NXevent_dataSection"><code>NXevent_data</code></link>
                                            Event-based data, such as a data set in which each count is recorded 
                                            as a separate data event. This form might be chosen when the data 
                                            are too sparse to be stored efficiently in histograms. 
                                            Normally, such data must be converted to a regular <code>NXdata</code>
                                            group before it can be analyzed. 
                                            <indexterm><primary>NXdata</primary></indexterm>
                                        </para></listitem>
                                        <listitem><para><link xlink:href="#NXuserSection"><code>NXuser</code></link>
                                            Details of a user, such as name, affiliation, email address, etc.
                                        </para></listitem>
                                        <listitem><para><link xlink:href="#NXprocessSection"><code>NXprocess</code></link>
                                            Group used to store details of how the data have been processed. 
                                        </para></listitem>
                                        <listitem><para><link xlink:href="#NXcharacterizationSection"><code>NXcharacterization</code></link>
                                            Information required for the analysis of this <code>NXentry</code>, 
                                            such as identification of empty can runs, vanadium runs, etc. 
                                        </para></listitem>
                                    </itemizedlist>
                                </para>
                            </listitem>
                        </itemizedlist>
                    </para>
                </listitem>
            </itemizedlist>
        </figure>
        <figure xml:id="list.additions.base" xreflabel="NeXus Base Classes that may be added to any base class">
            <title>NeXus Base Classes that may be added to any base class</title>
            <itemizedlist>
                <listitem><para><link xlink:href="#NXlogSection"><code>NXlog</code></link>
                    Any logged information.
                </para></listitem>
                <listitem><para><link xlink:href="#NXnoteSection"><code>NXnote</code></link>
                    Generic group designed to hold annotations, images, or any other type
                    of information not described in an existing base class.
                </para></listitem>
                <listitem><para><link xlink:href="#NXbeamSection"><code>NXbeam</code></link>
                    This group records the state of the radiation (neutron, X-ray, or muon) 
                    beam at any location. It could be referenced by instrument components 
                    within the <code>NXinstrument</code> group or by the <code>NXsample</code> 
                    group. In storing the results of instrument simulations in which it 
                    is useful to specify the beam profile, time distribution etc., at 
                    various stages down the beamline. Otherwise, its most likely use 
                    is in the <code>NXsample</code> group in which it defines the 
                    results of the radiation scattered by the sample, such as energy 
                    transfer, polarizations, and the like. 
                </para></listitem>
                <listitem><para><link xlink:href="#NXgeometrySection"><code>NXgeometry</code></link>
                    This group contains the geometrical information required to define the position, 
                    shape, and orientation of a NeXus object. This is especially important if 
                    the NeXus file contains the results of a comprehensive instrument simulation. 
                    For more details see <xref linkend="Design-CoordinateSystem"/>.
                    <itemizedlist>
                        <listitem><para><link xlink:href="#NXtranslationSection"><code>NXtranslation</code></link>
                            Defines the position of the object in either absolute coordinates or relative to another object.
                        </para></listitem>
                        <listitem><para><link xlink:href="#NXshapeSection"><code>NXshape</code></link>
                            Defines the shape of an object. 
                        </para></listitem>
                        <listitem><para><link xlink:href="#NXorientationSection"><code>NXorientation</code></link>
                            Defines the orientation (rotation) of the object. The <code>NXgeometry</code> group defines 
                            the shape of an object in terms of a conventional set of coordinate axes, 
                            but this group allows it to be rotated into an arbitrary orientation.
                        </para></listitem>
                    </itemizedlist>
                </para></listitem>
                <listitem><para><link xlink:href="#NXenvironmentSection"><code>NXenvironment</code></link>
                    Details of the surroundings (environment) of a beamline component. 
                    <itemizedlist>
                        <listitem><para><link xlink:href="#NXsensorSection"><code>NXsensor</code></link>
                            Describes any environment sensor.
                        </para></listitem>
                    </itemizedlist>
                </para></listitem>
            </itemizedlist>
        </figure>

</section>
