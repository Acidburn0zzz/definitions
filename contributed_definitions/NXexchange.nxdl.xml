<?xml version="1.0" encoding="UTF-8"?>
<!--
  NXdata_exchange
    A simple common exchange format for spectra and images
		written in the NeXus Definition Language
		as a NeXus "application definition"
		based on a proposal from Chris Jacobsen.
-->
<definition   xmlns="http://definition.nexusformat.org/nxdl/3.1"
  name="NXdata_exchange" 
  extends="NXobject" 
  type="group" 
  category="contributed"
  version="0.2b"
  svnid="$Id$"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://definition.nexusformat.org/nxdl/3.1 ../nxdl.xsd">

    <doc>
      +++ Under development and subject to unannounced changes +++

      Minimal format for exchange of images and spectra.
      Intended to be used as NXsubentry, as a child of a NXentry group.     
      "Start with something simple and immediately
      achievable: the exchange of multidimensional arrays between data analysis programs, rather
      than storage of all relevant information from all relevant beamlines."
    </doc>

    <attribute name="version">
      <doc>
        Version of this data standard applying to a specific data file.
        The version (currently "0.2b") of the particular revision of the standard is found in the
        /definition@version attribute of the NXDL definition for NXdata_exchange:
        http://trac.nexusformat.org/definitions/browser/trunk/contributed_definitions/NXdata_exchange.nxdl.xml
        <!-- would we prefer to use the SVN Id (without dollar signs) instead? -->
      </doc>
    </attribute>
    
    <!-- default type is NX_CHAR (any string representation) -->

    <field name="data" type="NX_NUMBER">
      <doc>
         An array that holds the spectrum, spectra, image, image set, ...

         Note that because HDF5 records the type of the data
         (float, 16 bit integer, etc.)  and the rank and dimensions, 
         the reading program should be able to handle reading any
          of these data types. 
          
        For multi-dimensional arrays, the ordering scheme is specified by NeXus
        (TODO  good place to re-describe the NeXus array index ordering scheme is here).
      </doc>
      <attribute name="complex_index" type="NX_INT">
        <doc>
          [TODO This needs more work.  HDF5 and also NeXus do not define how complex numbers are stored.]

          This attempts to work with the suggestion from THG.
          Flags the data as complex {real,imaginary} pairs. 
          If absent, negative or greater than the rank of the data, 
          it is assumed that the array is pure real. For an example 640x480 complex array, 
          one might have complex_index=0 and the data array has HDF5 stored dimensions of
          (2,640,480) which has a rank of 3.
        </doc>
      </attribute>
      <attribute name="data_type">
        <doc>
          Short name (one word, no whitespace) for the type of data collected.  
          For consistency, 
          users are encouraged to choose names from this list:
          transmission, optical_density, fluorescence, energy_loss,
          photoelectrons, diffraction_intensity, refractive_index, 
          coherent_diffraction_imaging.
          Keep in mind these notes about some of the types:
          transmission (units are dimensionless), 
          optical_density (absorbance with 1 meaning the transmittance was reduced by e-1),
          coherent_diffraction_imaging (In coherent diffraction imaging, the reconstructed image voxel values might be
              listed as complex values of transmission or of refractive_index.)
        </doc>
      </attribute>
      <attribute name="axes">
        <doc>
          Colon-delimited list of the positioner names, 
          such as:  axes="ttheta:energy", used to describe 
          each dimension of the "data".
          Each positioner in the "axes" list will have a 
          field (HDF5 "dataset") next to the plottable dataset and the length 
          of that vector must correspond to the length of the 
          corresponding axis of the plottable dataset.  For example:
          data is an array of size int16[500,200,1000] and has 
          an attribute axes="energy:ttheta:time".  There will be 
          three additional datasets in data_exchange defined as
          energy float64[500], ttheta float64[200], and time float64[1000].
        </doc>
      </attribute>
    </field>

    <!-- +++++++++++++++ optional items +++++++++++++++++++++++++++ -->

  <group type="NXsample">
    <doc>
      Description of each sample.  
      One NXsample for each.
    </doc>
  </group>  
  
  <group type="NXinstrument">
    <doc>
      Description of each instrument.  
      One NXinstrument for each.
    </doc>
  </group>
  
  <group type="NXuser">
    <doc>
      Description of each experimenter.  
      One NXuser for each person or group (use judgment).
    </doc>
  </group>
  
  <group type="NXnote" name="original_data">
    <doc>
      Document the file name(s) and time at which the original data was recorded.
      Record the date and time the data was acquired in the "date" field of this NXnote.
      Other fields include file_name, author, type (for MIME type), and a "data" field 
      that can be used to store a thumbnail or anything else.
    </doc>
  </group>
  
  <group type="NXnote">
    <doc>
      Record of any other item regarding the specimen or experiment.
    </doc>
  </group>
  
  <group type="NXprocess">
    <doc>
      Description of a data processing step.  
      One NXprocess for each data processing step.
      Record the date and time of the data processing step in the "date" field of NXprocess.
      Other fields include "program" and "version" fields and an NXnote for anything else.
    </doc>
  </group>
  
  <group type="NXcollection">
    <doc>
      Any set of fields or NeXus base clases.
    </doc>
  </group>

</definition>
