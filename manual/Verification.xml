<?xml version="1.0" encoding="UTF-8"?>
<?oxygen RNGSchema="http://www.oasis-open.org/docbook/xml/5.0/rng/docbook.rng" type="xml"?>
<!-- # $Id$ -->
<chapter xml:id="VerificationChapter" xmlns="http://docbook.org/ns/docbook" version="5.0"
    xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>Verification and validation of files</title>
    <indexterm significance="preferred">
        <primary>validation</primary>
    </indexterm>
    <indexterm significance="preferred">
        <primary>verification</primary>
        <see>validation</see>
    </indexterm>
    <para> 
        The intent of verification and validation of files is to ensure, in an unbiased way, that
        a given file conforms to the relevant specifications. NeXus uses various 
        automated
        tools to validate
        files. These tools include conversion of content from HDF to XML and transformation (via
        XSLT) from XML format to another such as NXDL, XSD, and Schematron. This chapter will first
        provide an overview of the process, then define the terms used in validation, then describe
        how multiple base classes or application definitions might apply to a given NeXus data file,
        and then describe the various validation techniques in more detail.  Validation does not
        check that the data content of the file is sensible; this requires scientific interpretation
        based on the technique.
    </para>

    <para>
        Validation is useful to anyone who manipulates or modifies the contents of NeXus files.
        This includes scientists/users, instrument staff, software developers, and those
        who might mine the files for metadata.  
        First, the scientist or user of the data 
        must be certain that
        the information in a file can be located reliably.  
        The instrument staff or software developer must be confident the information 
        they have written to the file has been located and formatted properly.
        At some time, the content of the NeXus file may contribute to a larger body of work
        such as a metadata catalog for a scientific instrument, a laboratory,
        or even an entire user facility.
    </para>

    <section>
        <title>Overview</title>
        <para> 
            NeXus files adhere to a set of rules and can be tested against these rules for
            compliance. The rules are implemented using standard tools and can themselves be tested
            to verify compliance with the standards for such definitions. Validation includes the
            testing of both NeXus data files and the NXDL specifications that describe the rules. 
        </para>
        <glosslist>
            <glossentry>
                <glossterm>NeXus data files</glossterm>
                <glossdef><para>
                    NeXus data files (also known as NeXus data file instances) are validated
                    to ensure the various parts of the data file are arranged according to
                    the governing NXDL specifications used in that file instance.
                </para></glossdef>
            </glossentry>
            <glossentry>
                <glossterm>NeXus Definition Language (NXDL) specification files</glossterm>
                <glossdef><para>
                    NXDL files are validated to ensure they adhere to the rules for writing
                    NeXus base classes and application definitions.
                </para></glossdef>
            </glossentry>
        </glosslist>
        
        <!-- 
            Describe what is being validated and what is not being validated.
            
            Each NXDL file must be validated against the rules for NXDL files.
            
            Each NeXus data file can be validated against the NXDL rules.  
            That validation is done using Schematron.
        -->
    </section>

    <section>
        <title>Definitions of these terms</title>
        <para>This is a paragraph.</para>
    </section>

    <section>
        <title>NeXus data files may use multiple base classes or application definitions</title>
        <para>This is a paragraph.</para>
    </section>

    <section>
        <title>Validation techniques</title>
        <indexterm>
            <primary>validation</primary>
        </indexterm>
        <para>
            Describe the tools used to validate files 
            from the user's perspective and then from the 
            software developer's perspective.
        </para>

        <section>
            <title>Overview</title>
            <para>This is a paragraph.</para>
        </section>

        <section>
            <title>Validation of NeXus data files</title>
            <indexterm>
                <primary>validation</primary>
                <secondary>NeXus data files</secondary>
            </indexterm>
            <para>
                Each NeXus data file can be validated against the NXDL rules. 
                (The full suite of NXDL specifications is converted into Schematron
                rules by an XSLT<indexterm><primary>XSLT</primary></indexterm> 
                transformation and then combined into a single file.
                It is not allowed to have a NeXus base class and also an application
                definition with the same name since one will override the other in the
                master Schematron file)
                The validation is done using Schematron and the 
                <literal>NXvalidate</literal> program.  Schematron was selected,
                rather than XML Schema (XSD), to permit established rules for NeXus
                files, especially the rule allowing the nodes within <code>NXentry</code>
                to appear in any order.
            </para>
            <note>
                <para>It is very important to describe what is and is not being validated.</para>
            </note>
            <para>
                First, the NeXus data file instance (either HDF or XML) is converted
            </para>
        </section>

        <section>
            <title>Validation of NeXus Definition Language (NXDL) specification files</title>
            <indexterm>
                <primary>validation</primary>
                <secondary>NXDL specifications</secondary>
            </indexterm>
            <para>
                Each NXDL file must be validated against the rules that define how NXDL files are
                to be arranged.  
                The rules are specified in the form of XML Schema (XSD).<indexterm>
                    <primary>XML Schema (XSD)</primary>
                </indexterm>
            </para>
        </section>

        <section>
            <title>Schematron</title>
            <indexterm significance="preferred">
                <primary>Schematron</primary>
            </indexterm>
            <para>This is a paragraph.</para>
        </section>

        <section>
            <title>Transformation of NXDL files to Schematron</title>
            <indexterm>
                <primary>NXDL</primary>
            </indexterm>
            <indexterm>
                <primary>Schematron</primary>
            </indexterm>
            <para>This is a paragraph.</para>
        </section>
        
        <section>
            <title>TO-DO</title>
            <indexterm>
                <primary>validation</primary>
                <secondary>To-do list</secondary>
            </indexterm>
            <para>Are units validated?</para>
            <para>What else is "to-do?"</para>
        </section>

    </section>

</chapter>
